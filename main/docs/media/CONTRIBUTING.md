# Contribution guidelines

Please ensure that any contribution contains code that passes **linting** and **tests** (unit and rendering ones), and that is correctly **formatted**.

To run the demo app:
```bash
$ npm run demo
```

The app is accessible on http://localhost:8080.

All following checks are mandatory for a contribution to be accepted. Thanks!

## Linting

Code linting is done using [ESLint](https://eslint.org/). To run it:
```bash
$ npm run lint
```

## Type checking

The library is written in Javascript with [JSDoc](https://jsdoc.app/) annotations, which allows typechecking with the [Typescript](https://www.typescriptlang.org/) compiler.
To run typechecking:
```bash
$ npm run typecheck
```

## Formatting

Code formatting is done using [Prettier](https://prettier.io). To re-format all code, run:
```bash
$ npm run format
```

## Testing

### Unit tests

Unit tests are written using [Jest](https://jestjs.io/) and are located in the `test/unit` folder.

To run them:
```bash
$ npm run test:unit
```

### Rendering tests

Rendering tests are also available for testing the output of a given JSON print spec. They use [pixelmatch](https://www.github.com/mapbox/pixelmatch)
to determine whether the received image is identical to the expected one for each print spec.

Test cases are located in the `test/rendering/cases` folder, where each folder corresponds to one test case. Folders contain:
* a `spec.json` file
* an `expected.png` file
* after tests have been run, a `received.png` file is also present and can be used to check differences with the expected result

To run the rendering tests:
```bash
$ npm run test:rendering
```

In case of a new or updated rendering test, the expected image can be generated by running:
```bash
$ npm run test:rendering -- --fix
```

This will in essence copy the `received.png` file to the `expected.png` one for each rendering test.
This command will logically always succeed.

Also running the following command will start the tests in interactive mode, i.e. without headless mode and with
the browser left running for 30mn:
```bash
$ npm run test:rendering -- --interactive
```
