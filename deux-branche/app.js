!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=44)}([function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}},function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var r=n(0),i=n(8),o=n(18),s=n(3),a=n(14),u=n(4),c=n(9),l=function(t){function e(n,r,i){var s=t.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=o.a;break;case 1:if(!n){s.destination=o.a;break}if("object"==typeof n){n instanceof e?(s.syncErrorThrowable=n.syncErrorThrowable,s.destination=n,n.add(s)):(s.syncErrorThrowable=!0,s.destination=new h(s,n));break}default:s.syncErrorThrowable=!0,s.destination=new h(s,n,r,i)}return s}return r.a(e,t),e.prototype[a.a]=function(){return this},e.create=function(t,n,r){var i=new e(t,n,r);return i.syncErrorThrowable=!1,i},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(s.a),h=function(t){function e(e,n,r,s){var a,u=t.call(this)||this;u._parentSubscriber=e;var c=u;return Object(i.a)(n)?a=n:n&&(a=n.next,r=n.error,s=n.complete,n!==o.a&&(c=Object.create(n),Object(i.a)(c.unsubscribe)&&u.add(c.unsubscribe.bind(c)),c.unsubscribe=u.unsubscribe.bind(u))),u._context=c,u._next=a,u._error=r,u._complete=s,u}return r.a(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;u.a.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=u.a.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):Object(c.a)(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;Object(c.a)(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};u.a.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),u.a.useDeprecatedSynchronousErrorHandling)throw t;Object(c.a)(t)}},e.prototype.__tryOrSetError=function(t,e,n){if(!u.a.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(e){return u.a.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(Object(c.a)(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(l)},function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var r=n(1);var i=n(14),o=n(18);var s=n(7),a=n(21);function u(t){return 0===t.length?a.a:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var c=n(4),l=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var s=this.operator,a=function(t,e,n){if(t){if(t instanceof r.a)return t;if(t[i.a])return t[i.a]()}return t||e||n?new r.a(t,e,n):new r.a(o.a)}(t,e,n);if(s?a.add(s.call(a,this.source)):a.add(this.source||c.a.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),c.a.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){c.a.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,n=e.closed,i=e.destination,o=e.isStopped;if(n||o)return!1;t=i&&i instanceof r.a?i:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=h(e))((function(e,r){var i;i=n.subscribe((function(e){try{t(e)}catch(t){r(t),i&&i.unsubscribe()}}),r,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[s.a]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:u(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=h(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function h(t){if(t||(t=c.a.Promise||Promise),!t)throw new Error("no Promise impl found");return t}},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(11),i=n(20),o=n(8),s=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),a=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this._parentOrParents,a=this._ctorUnsubscribe,c=this._unsubscribe,l=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(var h=0;h<n.length;++h){n[h].remove(this)}if(Object(o.a)(c)){a&&(this._unsubscribe=void 0);try{c.call(this)}catch(t){e=t instanceof s?u(t.errors):[t]}}if(Object(r.a)(l)){h=-1;for(var p=l.length;++h<p;){var f=l[h];if(Object(i.a)(f))try{f.unsubscribe()}catch(t){e=e||[],t instanceof s?e=e.concat(u(t.errors)):e.push(t)}}}if(e)throw new s(e)}},t.prototype.add=function(e){var n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){var r=n;(n=new t)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof t){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.EMPTY=((e=new t).closed=!0,e),t}();function u(t){return t.reduce((function(t,e){return t.concat(e instanceof s?e.errors:e)}),[])}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=!1,i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;r=t},get useDeprecatedSynchronousErrorHandling(){return r}}},function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}));const r="requestJob",i="jobStatus",o=2.54},function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return u})),n.d(e,"c",(function(){return c}));var r=n(0),i=n(1),o=n(2),s=n(17),a=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,n}return r.a(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(i.a),u=(i.a,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.a(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(i.a));i.a;function c(t,e){if(!e.closed)return t instanceof o.a?t.subscribe(e):Object(s.a)(t)(e)}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}()},function(t,e,n){"use strict";function r(t){return"function"==typeof t}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";function r(t){setTimeout((function(){throw t}),0)}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}()},function(t,e,n){"use strict";function r(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}n.d(e,"a",(function(){return i}));var i=r()},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(0),i=n(1);function o(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new s(t,e))}}var s=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new a(t,this.project,this.thisArg))},t}(),a=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return r.a(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(i.a)},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(2),i=n(3);function o(t,e){return new r.a((function(n){var r=new i.a,o=0;return r.add(e.schedule((function(){o!==t.length?(n.next(t[o++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}},function(t,e,n){"use strict";function r(t){return t&&"function"==typeof t.schedule}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var r=n(23),i=n(9),o=n(12),s=n(7),a=n(22),u=n(24),c=n(20),l=function(t){if(t&&"function"==typeof t[s.a])return l=t,function(t){var e=l[s.a]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(Object(a.a)(t))return Object(r.a)(t);if(Object(u.a)(t))return n=t,function(t){return n.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,i.a),t};if(t&&"function"==typeof t[o.a])return e=t,function(t){for(var n=e[o.a]();;){var r=void 0;try{r=n.next()}catch(e){return t.error(e),t}if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add((function(){n.return&&n.return()})),t};var e,n,l,h=Object(c.a)(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+h+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(4),i=n(9),o={closed:!0,next:function(t){},error:function(t){if(r.a.useDeprecatedSynchronousErrorHandling)throw t;Object(i.a)(t)},complete:function(){}}},,function(t,e,n){"use strict";function r(t){return null!==t&&"object"==typeof t}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";function r(t){return t}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(t){return function(e){for(var n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.complete()}}},function(t,e,n){"use strict";function r(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(2),i=n(23),o=n(15);function s(t,e){return e?Object(o.a)(t,e):new r.a(Object(i.a)(t))}},function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var r=n(2),i=n(17),o=n(3),s=n(7);var a=n(15),u=n(12);var c=n(24),l=n(22);function h(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[s.a]}(t))return function(t,e){return new r.a((function(n){var r=new o.a;return r.add(e.schedule((function(){var i=t[s.a]();r.add(i.subscribe({next:function(t){r.add(e.schedule((function(){return n.next(t)})))},error:function(t){r.add(e.schedule((function(){return n.error(t)})))},complete:function(){r.add(e.schedule((function(){return n.complete()})))}}))}))),r}))}(t,e);if(Object(c.a)(t))return function(t,e){return new r.a((function(n){var r=new o.a;return r.add(e.schedule((function(){return t.then((function(t){r.add(e.schedule((function(){n.next(t),r.add(e.schedule((function(){return n.complete()})))})))}),(function(t){r.add(e.schedule((function(){return n.error(t)})))}))}))),r}))}(t,e);if(Object(l.a)(t))return Object(a.a)(t,e);if(function(t){return t&&"function"==typeof t[u.a]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new r.a((function(n){var r,i=new o.a;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(e.schedule((function(){r=t[u.a](),i.add(e.schedule((function(){if(!n.closed){var t,e;try{var i=r.next();t=i.value,e=i.done}catch(t){return void n.error(t)}e?n.complete():(n.next(t),this.schedule())}})))}))),i}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function p(t,e){return e?h(t,e):t instanceof r.a?t:new r.a(Object(i.a)(t))}},,function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(16),i=n(25),o=n(15);function s(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return Object(r.a)(n)?(t.pop(),Object(o.a)(t,n)):Object(i.a)(t)}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(0),i=function(t){function e(e,n){var r=t.call(this)||this;return r.subject=e,r.subscriber=n,r.closed=!1,r}return r.a(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(n(3).a)},function(t,e,n){"use strict";n.d(e,"a",(function(){return h}));var r=n(0),i=n(2),o=n(1),s=n(3),a=n(10),u=n(29),c=n(14),l=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return r.a(e,t),e}(o.a),h=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return r.a(e,t),e.prototype[c.a]=function(){return new l(this)},e.prototype.lift=function(t){var e=new p(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new a.a;if(!this.isStopped)for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].next(t)},e.prototype.error=function(t){if(this.closed)throw new a.a;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new a.a;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),r=0;r<e;r++)n[r].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new a.a;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new a.a;return this.hasError?(t.error(this.thrownError),s.a.EMPTY):this.isStopped?(t.complete(),s.a.EMPTY):(this.observers.push(t),new u.a(this,t))},e.prototype.asObservable=function(){var t=new i.a;return t.source=this,t},e.create=function(t,e){return new p(t,e)},e}(i.a),p=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return r.a(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):s.a.EMPTY},e}(h)},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(0),i=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}(),o=function(t){function e(n,r){void 0===r&&(r=i.now);var o=t.call(this,n,(function(){return e.delegate&&e.delegate!==o?e.delegate.now():r()}))||this;return o.actions=[],o.active=!1,o.scheduled=void 0,o}return r.a(e,t),e.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,r,i):t.prototype.schedule.call(this,n,r,i)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(i)},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(0),i=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return r.a(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n=!1,r=void 0;try{this.work(t)}catch(t){n=!0,r=!!t&&t||new Error(t)}if(n)return this.unsubscribe(),r},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(function(t){function e(e,n){return t.call(this)||this}return r.a(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(n(3).a))},function(t,e,n){"use strict";var r=n(36),i=n(37),o=n(46);function s(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}const a=(s()?Object(r.a)(self,"message").pipe(Object(i.a)("data")):Object(r.a)(window,"inkmap.toPrinter").pipe(Object(i.a)("detail"))).pipe(Object(o.a)(t=>console.log("message to printer:",t)));var u="change",c="error",l="load";function h(){return function(){throw new Error("Unimplemented abstract method.")}()}var p=0;function f(t){return t.ol_uid||(t.ol_uid=String(++p))}var d,g=(d=function(t,e){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}d(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),_=function(t){function e(e){var n=this,r="Assertion failed. See https://openlayers.org/en/"+("v"+"6.4.3".split("-")[0])+"/doc/errors/#"+e+" for details.";return(n=t.call(this,r)||this).code=e,n.name="AssertionError",n.message=r,n}return g(e,t),e}(Error);function y(t,e){if(!t)throw new _(e)}var v="function"==typeof Object.assign?Object.assign:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),r=1,i=arguments.length;r<i;++r){var o=arguments[r];if(null!=o)for(var s in o)o.hasOwnProperty(s)&&(n[s]=o[s])}return n};function m(t){for(var e in t)delete t[e]}"function"==typeof Object.values&&Object.values;function b(t){var e;for(e in t)return!1;return!e}var x=function(){function t(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}return t.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,m(this.queuedElements_)},t.prototype.dequeue=function(){var t=this.elements_,e=this.priorities_,n=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));var r=this.keyFunction_(n);return delete this.queuedElements_[r],n},t.prototype.enqueue=function(t){y(!(this.keyFunction_(t)in this.queuedElements_),31);var e=this.priorityFunction_(t);return e!=1/0&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},t.prototype.getCount=function(){return this.elements_.length},t.prototype.getLeftChildIndex_=function(t){return 2*t+1},t.prototype.getRightChildIndex_=function(t){return 2*t+2},t.prototype.getParentIndex_=function(t){return t-1>>1},t.prototype.heapify_=function(){var t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)},t.prototype.isEmpty=function(){return 0===this.elements_.length},t.prototype.isKeyQueued=function(t){return t in this.queuedElements_},t.prototype.isQueued=function(t){return this.isKeyQueued(this.keyFunction_(t))},t.prototype.siftUp_=function(t){for(var e=this.elements_,n=this.priorities_,r=e.length,i=e[t],o=n[t],s=t;t<r>>1;){var a=this.getLeftChildIndex_(t),u=this.getRightChildIndex_(t),c=u<r&&n[u]<n[a]?u:a;e[t]=e[c],n[t]=n[c],t=c}e[t]=i,n[t]=o,this.siftDown_(s,t)},t.prototype.siftDown_=function(t,e){for(var n=this.elements_,r=this.priorities_,i=n[e],o=r[e];e>t;){var s=this.getParentIndex_(e);if(!(r[s]>o))break;n[e]=n[s],r[e]=r[s],e=s}n[e]=i,r[e]=o},t.prototype.reprioritize=function(){var t,e,n,r=this.priorityFunction_,i=this.elements_,o=this.priorities_,s=0,a=i.length;for(e=0;e<a;++e)(n=r(t=i[e]))==1/0?delete this.queuedElements_[this.keyFunction_(t)]:(o[s]=n,i[s++]=t);i.length=s,o.length=s,this.heapify_()},t}(),w=0,T=1,S=2,E=3,O=4,P=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),j=function(t){function e(e,n){var r=t.call(this,(function(t){return e.apply(null,t)}),(function(t){return t[0].getKey()}))||this;return r.boundHandleTileChange_=r.handleTileChange.bind(r),r.tileChangeCallback_=n,r.tilesLoading_=0,r.tilesLoadingKeys_={},r}return P(e,t),e.prototype.enqueue=function(e){var n=t.prototype.enqueue.call(this,e);n&&e[0].addEventListener(u,this.boundHandleTileChange_);return n},e.prototype.getTilesLoading=function(){return this.tilesLoading_},e.prototype.handleTileChange=function(t){var e=t.target,n=e.getState();if(e.hifi&&n===S||n===E||n===O){e.removeEventListener(u,this.boundHandleTileChange_);var r=e.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}},e.prototype.loadMoreTiles=function(t,e){for(var n,r,i=0;this.tilesLoading_<t&&i<e&&this.getCount()>0;)r=(n=this.dequeue()[0]).getKey(),n.getState()!==w||r in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++i,n.load())},e}(x);var R={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},C={};C[R.DEGREES]=2*Math.PI*6370997/360,C[R.FEET]=.3048,C[R.METERS]=1,C[R.USFEET]=1200/3937;var I=R,M=function(){function t(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}return t.prototype.canWrapX=function(){return this.canWrapX_},t.prototype.getCode=function(){return this.code_},t.prototype.getExtent=function(){return this.extent_},t.prototype.getUnits=function(){return this.units_},t.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||C[this.units_]},t.prototype.getWorldExtent=function(){return this.worldExtent_},t.prototype.getAxisOrientation=function(){return this.axisOrientation_},t.prototype.isGlobal=function(){return this.global_},t.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},t.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},t.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},t.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},t.prototype.setWorldExtent=function(t){this.worldExtent_=t},t.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},t.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},t}();function F(t,e,n){return Math.min(Math.max(t,e),n)}var A="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2},L="log2"in Math?Math.log2:function(t){return Math.log(t)*Math.LOG2E};function k(t){return t*Math.PI/180}function z(t,e){var n=t%e;return n*e<0?n+e:n}var N=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),G=6378137*Math.PI,U=[-G,-G,G,G],W=[-180,-85,180,85],Y=function(t){function e(e){return t.call(this,{code:e,units:I.METERS,extent:U,global:!0,worldExtent:W,getPointResolution:function(t,e){return t/A(e[1]/6378137)}})||this}return N(e,t),e}(M),X=[new Y("EPSG:3857"),new Y("EPSG:102100"),new Y("EPSG:102113"),new Y("EPSG:900913"),new Y("urn:ogc:def:crs:EPSG:6.18:3:3857"),new Y("urn:ogc:def:crs:EPSG::3857"),new Y("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Z(t,e,n){var r=t.length,i=n>1?n:2,o=e;void 0===o&&(o=i>2?t.slice():new Array(r));for(var s=G,a=0;a<r;a+=i){o[a]=s*t[a]/180;var u=6378137*Math.log(Math.tan(Math.PI*(+t[a+1]+90)/360));u>s?u=s:u<-s&&(u=-s),o[a+1]=u}return o}function K(t,e,n){var r=t.length,i=n>1?n:2,o=e;void 0===o&&(o=i>2?t.slice():new Array(r));for(var s=0;s<r;s+=i)o[s]=180*t[s]/G,o[s+1]=360*Math.atan(Math.exp(t[s+1]/6378137))/Math.PI-90;return o}var D=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),V=[-180,-90,180,90],q=6378137*Math.PI/180,B=function(t){function e(e,n){return t.call(this,{code:e,units:I.DEGREES,extent:V,axisOrientation:n,global:!0,metersPerUnit:q,worldExtent:V})||this}return D(e,t),e}(M),H=[new B("CRS:84"),new B("EPSG:4326","neu"),new B("urn:ogc:def:crs:EPSG::4326","neu"),new B("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new B("urn:ogc:def:crs:OGC:1.3:CRS84"),new B("urn:ogc:def:crs:OGC:2:84"),new B("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new B("urn:x-ogc:def:crs:EPSG:4326","neu")],Q={};var $={};function J(t,e,n){var r=t.getCode(),i=e.getCode();r in $||($[r]={}),$[r][i]=n}var tt="bottom-left",et="bottom-right",nt="top-left",rt="top-right";function it(t){for(var e=ut(),n=0,r=t.length;n<r;++n)pt(e,t[n]);return e}function ot(t,e,n){return n?(n[0]=t[0]-e,n[1]=t[1]-e,n[2]=t[2]+e,n[3]=t[3]+e,n):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function st(t,e){return function(t,e,n){return t[0]<=e&&e<=t[2]&&t[1]<=n&&n<=t[3]}(t,e[0],e[1])}function at(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function ut(){return[1/0,1/0,-1/0,-1/0]}function ct(t,e,n,r,i){return i?(i[0]=t,i[1]=e,i[2]=n,i[3]=r,i):[t,e,n,r]}function lt(t){return ct(1/0,1/0,-1/0,-1/0,t)}function ht(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function pt(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function ft(t){var e=0;return Et(t)||(e=Tt(t)*mt(t)),e}function dt(t){return[t[0],t[1]]}function gt(t){return[t[2],t[1]]}function _t(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function yt(t,e){var n;return e===tt?n=dt(t):e===et?n=gt(t):e===nt?n=xt(t):e===rt?n=wt(t):y(!1,13),n}function vt(t,e,n,r,i){var o=e*r[0]/2,s=e*r[1]/2,a=Math.cos(n),u=Math.sin(n),c=o*a,l=o*u,h=s*a,p=s*u,f=t[0],d=t[1],g=f-c+p,_=f-c-p,y=f+c-p,v=f+c+p,m=d-l-h,b=d-l+h,x=d+l+h,w=d+l-h;return ct(Math.min(g,_,y,v),Math.min(m,b,x,w),Math.max(g,_,y,v),Math.max(m,b,x,w),i)}function mt(t){return t[3]-t[1]}function bt(t,e,n){var r=n||[1/0,1/0,-1/0,-1/0];return St(t,e)?(t[0]>e[0]?r[0]=t[0]:r[0]=e[0],t[1]>e[1]?r[1]=t[1]:r[1]=e[1],t[2]<e[2]?r[2]=t[2]:r[2]=e[2],t[3]<e[3]?r[3]=t[3]:r[3]=e[3]):lt(r),r}function xt(t){return[t[0],t[3]]}function wt(t){return[t[2],t[3]]}function Tt(t){return t[2]-t[0]}function St(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function Et(t){return t[2]<t[0]||t[3]<t[1]}function Ot(t,e,n,r){var i=[];if(r>1)for(var o=t[2]-t[0],s=t[3]-t[1],a=0;a<r;++a)i.push(t[0]+o*a/r,t[1],t[2],t[1]+s*a/r,t[2]-o*a/r,t[3],t[0],t[3]-s*a/r);else i=[t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]];e(i,i,2);for(var u=[],c=[],l=(a=0,i.length);a<l;a+=2)u.push(i[a]),c.push(i[a+1]);return function(t,e,n){return ct(Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e),n)}(u,c,n)}function Pt(t,e,n){var r=n||6371008.8,i=k(t[1]),o=k(e[1]),s=(o-i)/2,a=k(e[0]-t[0])/2,u=Math.sin(s)*Math.sin(s)+Math.sin(a)*Math.sin(a)*Math.cos(i)*Math.cos(o);return 2*r*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))}function jt(t,e){for(var n=(""+t).split("."),r=(""+e).split("."),i=0;i<Math.max(n.length,r.length);i++){var o=parseInt(n[i]||"0",10),s=parseInt(r[i]||"0",10);if(o>s)return 1;if(s>o)return-1}return 0}function Rt(t,e,n){var r;if(void 0!==e){for(var i=0,o=t.length;i<o;++i)e[i]=t[i];r=e}else r=t.slice();return r}function Ct(t,e,n){if(void 0!==e&&t!==e){for(var r=0,i=t.length;r<i;++r)e[r]=t[r];t=e}return t}function It(t){!function(t,e){Q[t]=e}(t.getCode(),t),J(t,t,Rt)}function Mt(t){return"string"==typeof t?Q[t]||null:t||null}function Ft(t,e,n,r){var i,o=(t=Mt(t)).getPointResolutionFunc();if(o)i=o(e,n),r&&r!==t.getUnits()&&(s=t.getMetersPerUnit())&&(i=i*s/C[r]);else if(t.getUnits()==I.DEGREES&&!r||r==I.DEGREES)i=e;else{var s,a=kt(t,Mt("EPSG:4326")),u=[n[0]-e/2,n[1],n[0]+e/2,n[1],n[0],n[1]-e/2,n[0],n[1]+e/2];i=(Pt((u=a(u,u,2)).slice(0,2),u.slice(2,4))+Pt(u.slice(4,6),u.slice(6,8)))/2,void 0!==(s=r?C[r]:t.getMetersPerUnit())&&(i/=s)}return i}function At(t){!function(t){t.forEach(It)}(t),t.forEach((function(e){t.forEach((function(t){e!==t&&J(e,t,Rt)}))}))}function Lt(t,e){if(t===e)return!0;var n=t.getUnits()===e.getUnits();return(t.getCode()===e.getCode()||kt(t,e)===Rt)&&n}function kt(t,e){var n=function(t,e){var n;return t in $&&e in $[t]&&(n=$[t][e]),n}(t.getCode(),e.getCode());return n||(n=Ct),n}function zt(t,e){return kt(Mt(t),Mt(e))}function Nt(t,e,n){return zt(e,n)(t,void 0,t.length)}function Gt(t,e,n,r){return Ot(t,zt(e,n),void 0,r)}var Ut,Wt,Yt,Xt=null;function Zt(t,e){return Xt?Gt(t,Xt,e):t}At(X),At(H),Ut=X,Wt=Z,Yt=K,H.forEach((function(t){Ut.forEach((function(e){J(t,e,Wt),J(e,t,Yt)}))}));var Kt=function(){function t(t){this.propagationStopped,this.type=t,this.target=null}return t.prototype.preventDefault=function(){this.propagationStopped=!0},t.prototype.stopPropagation=function(){this.propagationStopped=!0},t}(),Dt="propertychange",Vt=function(){function t(){this.disposed=!1}return t.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},t.prototype.disposeInternal=function(){},t}();function qt(t,e){return t>e?1:t<e?-1:0}function Bt(t,e,n){var r=t.length;if(t[0]<=e)return 0;if(e<=t[r-1])return r-1;var i=void 0;if(n>0){for(i=1;i<r;++i)if(t[i]<e)return i-1}else if(n<0){for(i=1;i<r;++i)if(t[i]<=e)return i}else for(i=1;i<r;++i){if(t[i]==e)return i;if(t[i]<e)return t[i-1]-e<e-t[i]?i-1:i}return r-1}function Ht(){}var Qt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),$t=function(t){function e(e){var n=t.call(this)||this;return n.eventTarget_=e,n.pendingRemovals_=null,n.dispatching_=null,n.listeners_=null,n}return Qt(e,t),e.prototype.addEventListener=function(t,e){if(t&&e){var n=this.listeners_||(this.listeners_={}),r=n[t]||(n[t]=[]);-1===r.indexOf(e)&&r.push(e)}},e.prototype.dispatchEvent=function(t){var e="string"==typeof t?new Kt(t):t,n=e.type;e.target||(e.target=this.eventTarget_||this);var r,i=this.listeners_&&this.listeners_[n];if(i){var o=this.dispatching_||(this.dispatching_={}),s=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,s[n]=0),++o[n];for(var a=0,u=i.length;a<u;++a)if(!1===(r="handleEvent"in i[a]?i[a].handleEvent(e):i[a].call(this,e))||e.propagationStopped){r=!1;break}if(--o[n],0===o[n]){var c=s[n];for(delete s[n];c--;)this.removeEventListener(n,Ht);delete o[n]}return r}},e.prototype.disposeInternal=function(){this.listeners_&&m(this.listeners_)},e.prototype.getListeners=function(t){return this.listeners_&&this.listeners_[t]||void 0},e.prototype.hasListener=function(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)},e.prototype.removeEventListener=function(t,e){var n=this.listeners_&&this.listeners_[t];if(n){var r=n.indexOf(e);-1!==r&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[r]=Ht,++this.pendingRemovals_[t]):(n.splice(r,1),0===n.length&&delete this.listeners_[t]))}},e}(Vt);function Jt(t,e,n,r,i){if(r&&r!==t&&(n=n.bind(r)),i){var o=n;n=function(){t.removeEventListener(e,n),o.apply(this,arguments)}}var s={target:t,type:e,listener:n};return t.addEventListener(e,n),s}function te(t,e,n,r){return Jt(t,e,n,r,!0)}function ee(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),m(t))}var ne=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();var re=function(t){function e(){var e=t.call(this)||this;return e.revision_=0,e}return ne(e,t),e.prototype.changed=function(){++this.revision_,this.dispatchEvent(u)},e.prototype.getRevision=function(){return this.revision_},e.prototype.on=function(t,e){if(Array.isArray(t)){for(var n=t.length,r=new Array(n),i=0;i<n;++i)r[i]=Jt(this,t[i],e);return r}return Jt(this,t,e)},e.prototype.once=function(t,e){var n;if(Array.isArray(t)){var r=t.length;n=new Array(r);for(var i=0;i<r;++i)n[i]=te(this,t[i],e)}else n=te(this,t,e);return e.ol_key=n,n},e.prototype.un=function(t,e){var n=e.ol_key;if(n)!function(t){if(Array.isArray(t))for(var e=0,n=t.length;e<n;++e)ee(t[e]);else ee(t)}(n);else if(Array.isArray(t))for(var r=0,i=t.length;r<i;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)},e}($t),ie=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),oe=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.key=n,i.oldValue=r,i}return ie(e,t),e}(Kt),se=function(t){function e(e){var n=t.call(this)||this;return f(n),n.values_=null,void 0!==e&&n.setProperties(e),n}return ie(e,t),e.prototype.get=function(t){var e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},e.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},e.prototype.getProperties=function(){return this.values_&&v({},this.values_)||{}},e.prototype.hasProperties=function(){return!!this.values_},e.prototype.notify=function(t,e){var n;n=ue(t),this.dispatchEvent(new oe(n,t,e)),n=Dt,this.dispatchEvent(new oe(n,t,e))},e.prototype.set=function(t,e,n){var r=this.values_||(this.values_={});if(n)r[t]=e;else{var i=r[t];r[t]=e,i!==e&&this.notify(t,i)}},e.prototype.setProperties=function(t,e){for(var n in t)this.set(n,t[n],e)},e.prototype.unset=function(t,e){if(this.values_&&t in this.values_){var n=this.values_[t];delete this.values_[t],b(this.values_)&&(this.values_=null),e||this.notify(t,n)}},e}(re),ae={};function ue(t){return ae.hasOwnProperty(t)?ae[t]:ae[t]="change:"+t}var ce=se,le="opacity",he="visible",pe="extent",fe="zIndex",de="maxResolution",ge="minResolution",_e="maxZoom",ye="minZoom",ve="source",me=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),be=function(t){function e(e){var n=t.call(this)||this,r=v({},e);return r[le]=void 0!==e.opacity?e.opacity:1,y("number"==typeof r[le],64),r[he]=void 0===e.visible||e.visible,r[fe]=e.zIndex,r[de]=void 0!==e.maxResolution?e.maxResolution:1/0,r[ge]=void 0!==e.minResolution?e.minResolution:0,r[ye]=void 0!==e.minZoom?e.minZoom:-1/0,r[_e]=void 0!==e.maxZoom?e.maxZoom:1/0,n.className_=void 0!==r.className?e.className:"ol-layer",delete r.className,n.setProperties(r),n.state_=null,n}return me(e,t),e.prototype.getClassName=function(){return this.className_},e.prototype.getLayerState=function(t){var e=this.state_||{layer:this,managed:void 0===t||t},n=this.getZIndex();return e.opacity=F(Math.round(100*this.getOpacity())/100,0,1),e.sourceState=this.getSourceState(),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==n?n:!1===e.managed?1/0:0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e},e.prototype.getLayersArray=function(t){return h()},e.prototype.getLayerStatesArray=function(t){return h()},e.prototype.getExtent=function(){return this.get(pe)},e.prototype.getMaxResolution=function(){return this.get(de)},e.prototype.getMinResolution=function(){return this.get(ge)},e.prototype.getMinZoom=function(){return this.get(ye)},e.prototype.getMaxZoom=function(){return this.get(_e)},e.prototype.getOpacity=function(){return this.get(le)},e.prototype.getSourceState=function(){return h()},e.prototype.getVisible=function(){return this.get(he)},e.prototype.getZIndex=function(){return this.get(fe)},e.prototype.setExtent=function(t){this.set(pe,t)},e.prototype.setMaxResolution=function(t){this.set(de,t)},e.prototype.setMinResolution=function(t){this.set(ge,t)},e.prototype.setMaxZoom=function(t){this.set(_e,t)},e.prototype.setMinZoom=function(t){this.set(ye,t)},e.prototype.setOpacity=function(t){y("number"==typeof t,64),this.set(le,t)},e.prototype.setVisible=function(t){this.set(he,t)},e.prototype.setZIndex=function(t){this.set(fe,t)},e.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),t.prototype.disposeInternal.call(this)},e}(ce),xe="prerender",we="postrender",Te="precompose",Se="undefined",Ee="ready",Oe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();var Pe=function(t){function e(e){var n=this,r=v({},e);delete r.source,(n=t.call(this,r)||this).mapPrecomposeKey_=null,n.mapRenderKey_=null,n.sourceChangeKey_=null,n.renderer_=null,e.render&&(n.render=e.render),e.map&&n.setMap(e.map),n.addEventListener(ue(ve),n.handleSourcePropertyChange_);var i=e.source?e.source:null;return n.setSource(i),n}return Oe(e,t),e.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},e.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},e.prototype.getSource=function(){return this.get(ve)||null},e.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():Se},e.prototype.handleSourceChange_=function(){this.changed()},e.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(ee(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=Jt(t,u,this.handleSourceChange_,this)),this.changed()},e.prototype.getFeatures=function(t){return this.renderer_.getFeatures(t)},e.prototype.render=function(t,e){var n=this.getRenderer();if(n.prepareFrame(t))return n.renderFrame(t,e)},e.prototype.setMap=function(t){this.mapPrecomposeKey_&&(ee(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(ee(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=Jt(t,Te,(function(t){var e=t.frameState.layerStatesArray,n=this.getLayerState(!1);y(!e.some((function(t){return t.layer===n.layer})),67),e.push(n)}),this),this.mapRenderKey_=Jt(this,u,t.render,t),this.changed())},e.prototype.setSource=function(t){this.set(ve,t)},e.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},e.prototype.hasRenderer=function(){return!!this.renderer_},e.prototype.createRenderer=function(){return null},e.prototype.disposeInternal=function(){this.setSource(null),t.prototype.disposeInternal.call(this)},e}(be),je="preload",Re="useInterimTilesOnError",Ce=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ie=function(t){function e(e){var n=this,r=e||{},i=v({},r);return delete i.preload,delete i.useInterimTilesOnError,(n=t.call(this,i)||this).setPreload(void 0!==r.preload?r.preload:0),n.setUseInterimTilesOnError(void 0===r.useInterimTilesOnError||r.useInterimTilesOnError),n}return Ce(e,t),e.prototype.getPreload=function(){return this.get(je)},e.prototype.setPreload=function(t){this.set(je,t)},e.prototype.getUseInterimTilesOnError=function(){return this.get(Re)},e.prototype.setUseInterimTilesOnError=function(t){this.set(Re,t)},e}(Pe),Me=0,Fe=1,Ae=2,Le=3,ke=4,ze=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ne=function(t){function e(e){var n=t.call(this)||this;return n.boundHandleImageChange_=n.handleImageChange_.bind(n),n.layer_=e,n}return ze(e,t),e.prototype.getFeatures=function(t){return h()},e.prototype.prepareFrame=function(t){return h()},e.prototype.renderFrame=function(t,e){return h()},e.prototype.loadedTileCallback=function(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n},e.prototype.createLoadedTileFinder=function(t,e,n){return function(r,i){var o=this.loadedTileCallback.bind(this,n,r);return t.forEachLoadedTile(e,r,i,o)}.bind(this)},e.prototype.forEachFeatureAtCoordinate=function(t,e,n,r,i){},e.prototype.getDataAtPixel=function(t,e,n){return h()},e.prototype.getLayer=function(){return this.layer_},e.prototype.handleFontsChanged=function(){},e.prototype.handleImageChange_=function(t){t.target.getState()===Ae&&this.renderIfReadyAndVisible()},e.prototype.loadImage=function(t){var e=t.getState();return e!=Ae&&e!=Le&&t.addEventListener(u,this.boundHandleImageChange_),e==Me&&(t.load(),e=t.getState()),e==Ae},e.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==Ee&&t.changed()},e}(re),Ge=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ue=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.inversePixelTransform=n,o.frameState=r,o.context=i,o}return Ge(e,t),e}(Kt);new Array(6);function We(t,e){var n=e[0],r=e[1];return e[0]=t[0]*n+t[2]*r+t[4],e[1]=t[1]*n+t[3]*r+t[5],e}function Ye(t,e,n,r,i,o,s,a){var u=Math.sin(o),c=Math.cos(o);return t[0]=r*c,t[1]=i*u,t[2]=-r*u,t[3]=i*c,t[4]=s*r*c-a*r*u+e,t[5]=s*i*u+a*i*c+n,t}function Xe(t,e){var n,r=(n=e)[0]*n[3]-n[1]*n[2];y(0!==r,32);var i=e[0],o=e[1],s=e[2],a=e[3],u=e[4],c=e[5];return t[0]=a/r,t[1]=-o/r,t[2]=-s/r,t[3]=i/r,t[4]=(s*c-a*u)/r,t[5]=-(i*c-o*u)/r,t}function Ze(t){return"matrix("+t.join(", ")+")"}var Ke="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",De=(Ke.indexOf("firefox"),-1!==Ke.indexOf("safari")&&Ke.indexOf("chrom"),-1!==Ke.indexOf("webkit")&&Ke.indexOf("edge"),Ke.indexOf("macintosh"),"undefined"!=typeof devicePixelRatio&&devicePixelRatio,"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope),Ve="undefined"!=typeof Image&&Image.prototype.decode;!function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch(t){}}();function qe(t,e,n){var r=n&&n.length?n.shift():De?new OffscreenCanvas(t||300,e||300):document.createElement("canvas");return t&&(r.width=t),e&&(r.height=e),r.getContext("2d")}function Be(t){return t&&t.parentNode?t.parentNode.removeChild(t):null}var He=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),Qe=["style","variant","weight","size","lineHeight","family"],$e=function(t){var e=t.match(He);if(!e)return null;for(var n={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"},r=0,i=Qe.length;r<i;++r){var o=e[r+1];void 0!==o&&(n[Qe[r]]=o)}return n.families=n.family.split(/,\s?/),n},Je=new ce;(new $t).setSize=function(){console.warn("labelCache is deprecated.")};var tn,en,nn,rn=null,on={};(function(){var t,e,n=["monospace","serif"],r=n.length,i="wmytzilWMYTZIL@#/&?$%10";function o(t,o,s){for(var a=!0,u=0;u<r;++u){var c=n[u];if(e=an(t+" "+o+" 32px "+c,i),s!=c){var l=an(t+" "+o+" 32px "+s+","+c,i);a=a&&l!=e}}return!!a}function s(){for(var e=!0,n=Je.getKeys(),r=0,i=n.length;r<i;++r){var s=n[r];Je.get(s)<100&&(o.apply(this,s.split("\n"))?(m(on),rn=null,tn=void 0,Je.set(s,100)):(Je.set(s,Je.get(s)+1,!0),e=!1))}e&&(clearInterval(t),t=void 0)}})(),nn=on;function sn(t,e){return rn||(rn=qe(1,1)),t!=tn&&(rn.font=t,tn=rn.font),rn.measureText(e)}function an(t,e){return sn(t,e).width}function un(t,e,n,r){0!==e&&(t.translate(n,r),t.rotate(e),t.translate(-n,-r))}var cn=null;function ln(t){return De?Ze(t):(cn||(cn=qe(1,1).canvas),cn.style.transform=Ze(t),cn.style.transform)}var hn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pn=function(t){function e(e){var n=t.call(this,e)||this;return n.container=null,n.renderedResolution,n.tempTransform=[1,0,0,1,0,0],n.pixelTransform=[1,0,0,1,0,0],n.inversePixelTransform=[1,0,0,1,0,0],n.context=null,n.containerReused=!1,n}return hn(e,t),e.prototype.useContainer=function(t,e,n){var r,i,o=this.getLayer().getClassName();t&&""===t.style.opacity&&t.className===o&&((a=t.firstElementChild)instanceof HTMLCanvasElement&&(i=a.getContext("2d")));if(!i||0!==i.canvas.width&&i.canvas.style.transform!==e?this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1):(this.container=t,this.context=i,this.containerReused=!0),!this.container){(r=document.createElement("div")).className=o;var s=r.style;s.position="absolute",s.width="100%",s.height="100%";var a=(i=qe()).canvas;r.appendChild(a),(s=a.style).position="absolute",s.left="0",s.transformOrigin="top left",this.container=r,this.context=i}},e.prototype.clip=function(t,e,n){var r=e.pixelRatio,i=e.size[0]*r/2,o=e.size[1]*r/2,s=e.viewState.rotation,a=xt(n),u=wt(n),c=gt(n),l=dt(n);We(e.coordinateToPixelTransform,a),We(e.coordinateToPixelTransform,u),We(e.coordinateToPixelTransform,c),We(e.coordinateToPixelTransform,l),t.save(),un(t,-s,i,o),t.beginPath(),t.moveTo(a[0]*r,a[1]*r),t.lineTo(u[0]*r,u[1]*r),t.lineTo(c[0]*r,c[1]*r),t.lineTo(l[0]*r,l[1]*r),t.clip(),un(t,s,i,o)},e.prototype.clipUnrotated=function(t,e,n){var r=xt(n),i=wt(n),o=gt(n),s=dt(n);We(e.coordinateToPixelTransform,r),We(e.coordinateToPixelTransform,i),We(e.coordinateToPixelTransform,o),We(e.coordinateToPixelTransform,s);var a=this.inversePixelTransform;We(a,r),We(a,i),We(a,o),We(a,s),t.save(),t.beginPath(),t.moveTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(i[0]),Math.round(i[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.clip()},e.prototype.dispatchRenderEvent_=function(t,e,n){var r=this.getLayer();if(r.hasListener(t)){var i=new Ue(t,this.inversePixelTransform,n,e);r.dispatchEvent(i)}},e.prototype.preRender=function(t,e){this.dispatchRenderEvent_(xe,t,e)},e.prototype.postRender=function(t,e){this.dispatchRenderEvent_(we,t,e)},e.prototype.getRenderTransform=function(t,e,n,r,i,o,s){var a=i/2,u=o/2,c=r/e,l=-c,h=-t[0]+s,p=-t[1];return Ye(this.tempTransform,a,u,c,l,-n,h,p)},e.prototype.getDataAtPixel=function(t,e,n){var r,i=We(this.inversePixelTransform,t.slice()),o=this.context;try{var s=Math.round(i[0]),a=Math.round(i[1]),u=document.createElement("canvas"),c=u.getContext("2d");u.width=1,u.height=1,c.clearRect(0,0,1,1),c.drawImage(o.canvas,s,a,1,1,0,0,1,1),r=c.getImageData(0,0,1,1).data}catch(t){return"SecurityError"===t.name?new Uint8Array:r}return 0===r[3]?null:r},e}(Ne),fn=function(){function t(t,e,n,r){this.minX=t,this.maxX=e,this.minY=n,this.maxY=r}return t.prototype.contains=function(t){return this.containsXY(t[1],t[2])},t.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY},t.prototype.containsXY=function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY},t.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY},t.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)},t.prototype.getHeight=function(){return this.maxY-this.minY+1},t.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},t.prototype.getWidth=function(){return this.maxX-this.minX+1},t.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY},t}();function dn(t,e,n,r,i){return void 0!==i?(i.minX=t,i.maxX=e,i.minY=n,i.maxY=r,i):new fn(t,e,n,r)}var gn=fn,_n=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),yn=function(t){function e(e){var n=t.call(this,e)||this;return n.extentChanged=!0,n.renderedExtent_=null,n.renderedPixelRatio,n.renderedProjection=null,n.renderedRevision,n.renderedTiles=[],n.newTiles_=!1,n.tmpExtent=[1/0,1/0,-1/0,-1/0],n.tmpTileRange_=new gn(0,0,0,0),n}return _n(e,t),e.prototype.isDrawableTile=function(t){var e=this.getLayer(),n=t.getState(),r=e.getUseInterimTilesOnError();return n==S||n==O||n==E&&!r},e.prototype.getTile=function(t,e,n,r){var i=r.pixelRatio,o=r.viewState.projection,s=this.getLayer(),a=s.getSource().getTile(t,e,n,i,o);return a.getState()==E&&(s.getUseInterimTilesOnError()?s.getPreload()>0&&(this.newTiles_=!0):a.setState(S)),this.isDrawableTile(a)||(a=a.getInterimTile()),a},e.prototype.loadedTileCallback=function(e,n,r){return!!this.isDrawableTile(r)&&t.prototype.loadedTileCallback.call(this,e,n,r)},e.prototype.prepareFrame=function(t){return!!this.getLayer().getSource()},e.prototype.renderFrame=function(t,e){var n=t.layerStatesArray[t.layerIndex],r=t.viewState,i=r.projection,o=r.resolution,s=r.center,a=r.rotation,u=t.pixelRatio,c=this.getLayer(),l=c.getSource(),h=l.getRevision(),p=l.getTileGridForProjection(i),d=p.getZForResolution(o,l.zDirection),g=p.getResolution(d),_=t.extent,y=n.extent&&Zt(n.extent,i);y&&(_=bt(_,Zt(n.extent,i)));var m=l.getTilePixelRatio(u),b=Math.round(t.size[0]*m),x=Math.round(t.size[1]*m);if(a){var w=Math.round(Math.sqrt(b*b+x*x));b=w,x=w}var T=g*b/2/m,E=g*x/2/m,O=[s[0]-T,s[1]-E,s[0]+T,s[1]+E],P=p.getTileRangeForExtentAndZ(_,d),j={};j[d]={};var R=this.createLoadedTileFinder(l,i,j),C=this.tmpExtent,I=this.tmpTileRange_;this.newTiles_=!1;for(var M=P.minX;M<=P.maxX;++M)for(var F=P.minY;F<=P.maxY;++F){var A=this.getTile(d,M,F,t);if(this.isDrawableTile(A)){var L=f(this);if(A.getState()==S){j[d][A.tileCoord.toString()]=A;var k=A.inTransition(L);this.newTiles_||!k&&-1!==this.renderedTiles.indexOf(A)||(this.newTiles_=!0)}if(1===A.getAlpha(L,t.time))continue}var z=p.getTileCoordChildTileRange(A.tileCoord,I,C),N=!1;z&&(N=R(d+1,z)),N||p.forEachTileCoordParentTileRange(A.tileCoord,R,I,C)}var G=g/o;Ye(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/m,1/m,a,-b/2,-x/2);var U=ln(this.pixelTransform);this.useContainer(e,U,n.opacity);var W=this.context,Y=W.canvas;Xe(this.inversePixelTransform,this.pixelTransform),Ye(this.tempTransform,b/2,x/2,G,G,0,-b/2,-x/2),Y.width!=b||Y.height!=x?(Y.width=b,Y.height=x):this.containerReused||W.clearRect(0,0,b,x),y&&this.clipUnrotated(W,t,y),v(W,l.getContextOptions()),this.preRender(W,t),this.renderedTiles.length=0;var X,Z,K,D=Object.keys(j).map(Number);D.sort(qt),1!==n.opacity||this.containerReused&&!l.getOpaque(t.viewState.projection)?(X=[],Z=[]):D=D.reverse();for(var V=D.length-1;V>=0;--V){var q=D[V],B=l.getTilePixelSize(q,u,i),H=p.getResolution(q)/g,Q=B[0]*H*G,$=B[1]*H*G,J=p.getTileCoordForCoordAndZ(xt(O),q),tt=p.getTileCoordExtent(J),et=We(this.tempTransform,[m*(tt[0]-O[0])/g,m*(O[3]-tt[3])/g]),nt=m*l.getGutterForProjection(i),rt=j[q];for(var it in rt){var ot=(A=rt[it]).tileCoord,st=et[0]-(J[1]-ot[1])*Q,at=Math.round(st+Q),ut=et[1]-(J[2]-ot[2])*$,ct=Math.round(ut+$),lt=at-(M=Math.round(st)),pt=ct-(F=Math.round(ut)),ft=d===q;if(!(k=ft&&1!==A.getAlpha(f(this),t.time)))if(X){W.save(),K=[M,F,M+lt,F,M+lt,F+pt,M,F+pt];for(var dt=0,gt=X.length;dt<gt;++dt)if(d!==q&&q<Z[dt]){var _t=X[dt];W.beginPath(),W.moveTo(K[0],K[1]),W.lineTo(K[2],K[3]),W.lineTo(K[4],K[5]),W.lineTo(K[6],K[7]),W.moveTo(_t[6],_t[7]),W.lineTo(_t[4],_t[5]),W.lineTo(_t[2],_t[3]),W.lineTo(_t[0],_t[1]),W.clip()}X.push(K),Z.push(q)}else W.clearRect(M,F,lt,pt);this.drawTileImage(A,t,M,F,lt,pt,nt,ft,n.opacity),X&&!k&&W.restore(),this.renderedTiles.push(A),this.updateUsedTiles(t.usedTiles,l,A)}}return this.renderedRevision=h,this.renderedResolution=g,this.extentChanged=!this.renderedExtent_||!ht(this.renderedExtent_,O),this.renderedExtent_=O,this.renderedPixelRatio=u,this.renderedProjection=i,this.manageTilePyramid(t,l,p,u,i,_,d,c.getPreload()),this.scheduleExpireCache(t,l),this.postRender(W,t),n.extent&&W.restore(),U!==Y.style.transform&&(Y.style.transform=U),this.container},e.prototype.drawTileImage=function(t,e,n,r,i,o,s,a,u){var c=this.getTileImage(t);if(c){var l=f(this),h=a?t.getAlpha(l,e.time):1,p=u*h,d=p!==this.context.globalAlpha;d&&(this.context.save(),this.context.globalAlpha=p),this.context.drawImage(c,s,s,c.width-2*s,c.height-2*s,n,r,i,o),d&&this.context.restore(),1!==h?e.animate=!0:a&&t.endTransition(l)}},e.prototype.getImage=function(){var t=this.context;return t?t.canvas:null},e.prototype.getTileImage=function(t){return t.getImage()},e.prototype.scheduleExpireCache=function(t,e){if(e.canExpireCache()){var n=function(t,e,n){var r=f(t);r in n.usedTiles&&t.expireCache(n.viewState.projection,n.usedTiles[r])}.bind(null,e);t.postRenderFunctions.push(n)}},e.prototype.updateUsedTiles=function(t,e,n){var r=f(e);r in t||(t[r]={}),t[r][n.getKey()]=!0},e.prototype.manageTilePyramid=function(t,e,n,r,i,o,s,a,u){var c=f(e);c in t.wantedTiles||(t.wantedTiles[c]={});var l,h,p,d,g,_,y=t.wantedTiles[c],v=t.tileQueue,m=0;for(_=n.getMinZoom();_<=s;++_)for(h=n.getTileRangeForExtentAndZ(o,_,h),p=n.getResolution(_),d=h.minX;d<=h.maxX;++d)for(g=h.minY;g<=h.maxY;++g)s-_<=a?(++m,(l=e.getTile(_,d,g,r,i)).getState()==w&&(y[l.getKey()]=!0,v.isKeyQueued(l.getKey())||v.enqueue([l,c,n.getTileCoordCenter(l.tileCoord),p])),void 0!==u&&u(l)):e.useTile(_,d,g,i);e.updateCacheSize(m,i)},e}(pn);yn.prototype.getLayer;var vn=yn,mn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),bn=function(t){function e(e){return t.call(this,e)||this}return mn(e,t),e.prototype.createRenderer=function(){return new vn(this)},e}(Ie);function xn(t){return Math.pow(t,3)}var wn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Tn=function(t){function e(e,n,r){var i=t.call(this)||this,o=r||{};return i.tileCoord=e,i.state=n,i.interimTile=null,i.hifi=!0,i.key="",i.transition_=void 0===o.transition?250:o.transition,i.transitionStarts_={},i}return wn(e,t),e.prototype.changed=function(){this.dispatchEvent(u)},e.prototype.release=function(){},e.prototype.getKey=function(){return this.key+"/"+this.tileCoord},e.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==S)return this.transition_=0,t;t=t.interimTile}while(t);return this},e.prototype.refreshInterimChain=function(){if(this.interimTile){var t=this.interimTile,e=this;do{if(t.getState()==S){t.interimTile=null;break}t.getState()==T?e=t:t.getState()==w?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}},e.prototype.getTileCoord=function(){return this.tileCoord},e.prototype.getState=function(){return this.state},e.prototype.setState=function(t){if(this.state!==E&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()},e.prototype.load=function(){h()},e.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var n=this.transitionStarts_[t];if(n){if(-1===n)return 1}else n=e,this.transitionStarts_[t]=n;var r=e-n+1e3/60;return r>=this.transition_?1:xn(r/this.transition_)},e.prototype.inTransition=function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]},e.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},e}($t),Sn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),En=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.extent=e,o.pixelRatio_=r,o.resolution=n,o.state=i,o}return Sn(e,t),e.prototype.changed=function(){this.dispatchEvent(u)},e.prototype.getExtent=function(){return this.extent},e.prototype.getImage=function(){return h()},e.prototype.getPixelRatio=function(){return this.pixelRatio_},e.prototype.getResolution=function(){return this.resolution},e.prototype.getState=function(){return this.state},e.prototype.load=function(){h()},e}($t),On=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function Pn(t,e,n){var r=t;if(r.src&&Ve){var i=r.decode(),o=!0;return i.then((function(){o&&e()})).catch((function(t){o&&("EncodingError"===t.name&&"Invalid image type."===t.message?e():n())})),function(){o=!1}}var s=[te(r,l,e),te(r,c,n)];return function(){s.forEach(ee)}}var jn=function(t){function e(e,n,r,i,o,s){var a=t.call(this,e,n,r,Me)||this;return a.src_=i,a.image_=new Image,null!==o&&(a.image_.crossOrigin=o),a.unlisten_=null,a.state=Me,a.imageLoadFunction_=s,a}return On(e,t),e.prototype.getImage=function(){return this.image_},e.prototype.handleImageError_=function(){this.state=Le,this.unlistenImage_(),this.changed()},e.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=mt(this.extent)/this.image_.height),this.state=Ae,this.unlistenImage_(),this.changed()},e.prototype.load=function(){this.state!=Me&&this.state!=Le||(this.state=Fe,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=Pn(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.setImage=function(t){this.image_=t},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(En),Rn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();var Cn,In=function(t){function e(e,n,r,i,o,s){var a=t.call(this,e,n,s)||this;return a.crossOrigin_=i,a.src_=r,a.image_=new Image,null!==i&&(a.image_.crossOrigin=i),a.unlisten_=null,a.tileLoadFunction_=o,a}return Rn(e,t),e.prototype.getImage=function(){return this.image_},e.prototype.getKey=function(){return this.src_},e.prototype.handleImageError_=function(){var t;this.state=E,this.unlistenImage_(),this.image_=((t=qe(1,1)).fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas),this.changed()},e.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=S:this.state=O,this.unlistenImage_(),this.changed()},e.prototype.load=function(){this.state==E&&(this.state=w,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==w&&(this.state=T,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Pn(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(Tn),Mn=function(){function t(t,e,n,r,i,o){this.sourceProj_=t,this.targetProj_=e;var s={},a=zt(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var e=t[0]+"/"+t[1];return s[e]||(s[e]=a(t)),s[e]},this.maxSourceExtent_=r,this.errorThresholdSquared_=i*i,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&Tt(r)==Tt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Tt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Tt(this.targetProj_.getExtent()):null;var u=xt(n),c=wt(n),l=gt(n),h=dt(n),p=this.transformInv_(u),f=this.transformInv_(c),d=this.transformInv_(l),g=this.transformInv_(h),_=10+(o?Math.max(0,Math.ceil(L(ft(n)/(o*o*256*256)))):0);if(this.addQuad_(u,c,l,h,p,f,d,g,_),this.wrapsXInSource_){var y=1/0;this.triangles_.forEach((function(t,e,n){y=Math.min(y,t.source[0][0],t.source[1][0],t.source[2][0])})),this.triangles_.forEach(function(t){if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-y>this.sourceWorldWidth_/2){var e=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];e[0][0]-y>this.sourceWorldWidth_/2&&(e[0][0]-=this.sourceWorldWidth_),e[1][0]-y>this.sourceWorldWidth_/2&&(e[1][0]-=this.sourceWorldWidth_),e[2][0]-y>this.sourceWorldWidth_/2&&(e[2][0]-=this.sourceWorldWidth_);var n=Math.min(e[0][0],e[1][0],e[2][0]);Math.max(e[0][0],e[1][0],e[2][0])-n<this.sourceWorldWidth_/2&&(t.source=e)}}.bind(this))}s={}}return t.prototype.addTriangle_=function(t,e,n,r,i,o){this.triangles_.push({source:[r,i,o],target:[t,e,n]})},t.prototype.addQuad_=function(t,e,n,r,i,o,s,a,u){var c=it([i,o,s,a]),l=this.sourceWorldWidth_?Tt(c)/this.sourceWorldWidth_:null,h=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&l>.5&&l<1,f=!1;if(u>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_)f=Tt(it([t,e,n,r]))/this.targetWorldWidth_>.25||f;!p&&this.sourceProj_.isGlobal()&&l&&(f=l>.25||f)}if(!(!f&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3]))||St(c,this.maxSourceExtent_)){var d=0;if(!(f||isFinite(i[0])&&isFinite(i[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(s[0])&&isFinite(s[1])&&isFinite(a[0])&&isFinite(a[1])))if(u>0)f=!0;else if(1!=(d=(isFinite(i[0])&&isFinite(i[1])?0:8)+(isFinite(o[0])&&isFinite(o[1])?0:4)+(isFinite(s[0])&&isFinite(s[1])?0:2)+(isFinite(a[0])&&isFinite(a[1])?0:1))&&2!=d&&4!=d&&8!=d)return;if(u>0){if(!f){var g=[(t[0]+n[0])/2,(t[1]+n[1])/2],_=this.transformInv_(g),y=void 0;if(p)y=(z(i[0],h)+z(s[0],h))/2-z(_[0],h);else y=(i[0]+s[0])/2-_[0];var v=(i[1]+s[1])/2-_[1];f=y*y+v*v>this.errorThresholdSquared_}if(f){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){var m=[(e[0]+n[0])/2,(e[1]+n[1])/2],b=this.transformInv_(m),x=[(r[0]+t[0])/2,(r[1]+t[1])/2],w=this.transformInv_(x);this.addQuad_(t,e,m,x,i,o,b,w,u-1),this.addQuad_(x,m,n,r,w,b,s,a,u-1)}else{var T=[(t[0]+e[0])/2,(t[1]+e[1])/2],S=this.transformInv_(T),E=[(n[0]+r[0])/2,(n[1]+r[1])/2],O=this.transformInv_(E);this.addQuad_(t,T,E,r,i,S,O,a,u-1),this.addQuad_(T,e,n,E,S,o,s,O,u-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&d)&&this.addTriangle_(t,n,r,i,s,a),0==(14&d)&&this.addTriangle_(t,n,e,i,s,o),d&&(0==(13&d)&&this.addTriangle_(e,r,t,o,a,i),0==(7&d)&&this.addTriangle_(e,r,n,o,a,s))}},t.prototype.calculateSourceExtent=function(){var t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach((function(e,n,r){var i=e.source;pt(t,i[0]),pt(t,i[1]),pt(t,i[2])})),t},t.prototype.getTriangles=function(){return this.triangles_},t}(),Fn={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1};function An(t,e,n,r,i){t.beginPath(),t.moveTo(0,0),t.lineTo(e,n),t.lineTo(r,i),t.closePath(),t.save(),t.clip(),t.fillRect(0,0,Math.max(e,r)+1,Math.max(n,i)),t.restore()}function Ln(t,e){return Math.abs(t[4*e]-210)>2||Math.abs(t[4*e+3]-191.25)>2}function kn(t,e,n,r){var i=Nt(n,e,t),o=Ft(e,r,n),s=e.getMetersPerUnit();void 0!==s&&(o*=s);var a=t.getMetersPerUnit();void 0!==a&&(o/=a);var u=t.getExtent();if(!u||st(u,i)){var c=Ft(t,o,i)/o;isFinite(c)&&c>0&&(o/=c)}return o}function zn(t,e,n,r){var i,o,s=_t(n),a=kn(t,e,s,r);return(!isFinite(a)||a<=0)&&((o=function(n){return a=kn(t,e,n,r),isFinite(a)&&a>0})(dt(i=n))||o(gt(i))||o(wt(i))||o(xt(i))),a}function Nn(t,e,n,r,i,o,s,a,u,c,l,h){var p=qe(Math.round(n*t),Math.round(n*e));if(v(p,h),0===u.length)return p.canvas;function f(t){return Math.round(t*n)/n}p.scale(n,n),p.globalCompositeOperation="lighter";var d=[1/0,1/0,-1/0,-1/0];u.forEach((function(t,e,n){var r,i;r=d,(i=t.extent)[0]<r[0]&&(r[0]=i[0]),i[2]>r[2]&&(r[2]=i[2]),i[1]<r[1]&&(r[1]=i[1]),i[3]>r[3]&&(r[3]=i[3])}));var g=Tt(d),_=mt(d),y=qe(Math.round(n*g/r),Math.round(n*_/r));v(y,h);var m=n/r;u.forEach((function(t,e,n){var r=t.extent[0]-d[0],i=-(t.extent[3]-d[3]),o=Tt(t.extent),s=mt(t.extent);t.image.width>0&&t.image.height>0&&y.drawImage(t.image,c,c,t.image.width-2*c,t.image.height-2*c,r*m,i*m,o*m,s*m)}));var b=xt(s);return a.getTriangles().forEach((function(t,e,i){var s=t.source,a=t.target,u=s[0][0],c=s[0][1],l=s[1][0],g=s[1][1],_=s[2][0],v=s[2][1],m=f((a[0][0]-b[0])/o),x=f(-(a[0][1]-b[1])/o),w=f((a[1][0]-b[0])/o),T=f(-(a[1][1]-b[1])/o),S=f((a[2][0]-b[0])/o),E=f(-(a[2][1]-b[1])/o),O=u,P=c;u=0,c=0;var j=function(t){for(var e=t.length,n=0;n<e;n++){for(var r=n,i=Math.abs(t[n][n]),o=n+1;o<e;o++){var s=Math.abs(t[o][n]);s>i&&(i=s,r=o)}if(0===i)return null;var a=t[r];t[r]=t[n],t[n]=a;for(var u=n+1;u<e;u++)for(var c=-t[u][n]/t[n][n],l=n;l<e+1;l++)n==l?t[u][l]=0:t[u][l]+=c*t[n][l]}for(var h=new Array(e),p=e-1;p>=0;p--){h[p]=t[p][e]/t[p][p];for(var f=p-1;f>=0;f--)t[f][e]-=t[f][p]*h[p]}return h}([[l-=O,g-=P,0,0,w-m],[_-=O,v-=P,0,0,S-m],[0,0,l,g,T-x],[0,0,_,v,E-x]]);if(j){if(p.save(),p.beginPath(),function(){if(void 0===Cn){var t=document.createElement("canvas").getContext("2d");t.globalCompositeOperation="lighter",t.fillStyle="rgba(210, 0, 0, 0.75)",An(t,4,5,4,0),An(t,4,5,0,5);var e=t.getImageData(0,0,3,3).data;Cn=Ln(e,0)||Ln(e,4)||Ln(e,8)}return Cn}()||h===Fn){p.moveTo(w,T);for(var R=m-w,C=x-T,I=0;I<4;I++)p.lineTo(w+f((I+1)*R/4),T+f(I*C/3)),3!=I&&p.lineTo(w+f((I+1)*R/4),T+f((I+1)*C/3));p.lineTo(S,E)}else p.moveTo(w,T),p.lineTo(m,x),p.lineTo(S,E);p.clip(),p.transform(j[0],j[2],j[1],j[3],m,x),p.translate(d[0]-O,d[3]-P),p.scale(r/n,-r/n),p.drawImage(y.canvas,0,0),p.restore()}})),l&&(p.save(),p.globalCompositeOperation="source-over",p.strokeStyle="black",p.lineWidth=1,a.getTriangles().forEach((function(t,e,n){var r=t.target,i=(r[0][0]-b[0])/o,s=-(r[0][1]-b[1])/o,a=(r[1][0]-b[0])/o,u=-(r[1][1]-b[1])/o,c=(r[2][0]-b[0])/o,l=-(r[2][1]-b[1])/o;p.beginPath(),p.moveTo(a,u),p.lineTo(i,s),p.lineTo(c,l),p.closePath(),p.stroke()})),p.restore()),p.canvas}var Gn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Un=function(t){function e(e,n,r,i,o,s,a,u,c,l,h,p){var f=t.call(this,o,w)||this;f.renderEdges_=void 0!==h&&h,f.contextOptions_=p,f.pixelRatio_=a,f.gutter_=u,f.canvas_=null,f.sourceTileGrid_=n,f.targetTileGrid_=i,f.wrappedTileCoord_=s||o,f.sourceTiles_=[],f.sourcesListenerKeys_=null,f.sourceZ_=0;var d=i.getTileCoordExtent(f.wrappedTileCoord_),g=f.targetTileGrid_.getExtent(),_=f.sourceTileGrid_.getExtent(),y=g?bt(d,g):d;if(0===ft(y))return f.state=O,f;var v=e.getExtent();v&&(_=_?bt(_,v):v);var m=i.getResolution(f.wrappedTileCoord_[0]),b=zn(e,r,y,m);if(!isFinite(b)||b<=0)return f.state=O,f;var x=void 0!==l?l:.5;if(f.triangulation_=new Mn(e,r,y,_,b*x,m),0===f.triangulation_.getTriangles().length)return f.state=O,f;f.sourceZ_=n.getZForResolution(b);var T=f.triangulation_.calculateSourceExtent();if(_&&(e.canWrapX()?(T[1]=F(T[1],_[1],_[3]),T[3]=F(T[3],_[1],_[3])):T=bt(T,_)),ft(T)){for(var S=n.getTileRangeForExtentAndZ(T,f.sourceZ_),E=S.minX;E<=S.maxX;E++)for(var P=S.minY;P<=S.maxY;P++){var j=c(f.sourceZ_,E,P,a);j&&f.sourceTiles_.push(j)}0===f.sourceTiles_.length&&(f.state=O)}else f.state=O;return f}return Gn(e,t),e.prototype.getImage=function(){return this.canvas_},e.prototype.reproject_=function(){var t=[];if(this.sourceTiles_.forEach(function(e,n,r){e&&e.getState()==S&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===t.length)this.state=E;else{var e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),r="number"==typeof n?n:n[0],i="number"==typeof n?n:n[1],o=this.targetTileGrid_.getResolution(e),s=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Nn(r,i,this.pixelRatio_,s,this.sourceTileGrid_.getExtent(),o,a,this.triangulation_,t,this.gutter_,this.renderEdges_,this.contextOptions_),this.state=S}this.changed()},e.prototype.load=function(){if(this.state==w){this.state=T,this.changed();var t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,n,r){var i=e.getState();if(i==w||i==T){t++;var o=Jt(e,u,(function(n){var r=e.getState();r!=S&&r!=E&&r!=O||(ee(o),0===--t&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(o)}}.bind(this)),this.sourceTiles_.forEach((function(t,e,n){t.getState()==w&&t.load()})),0===t&&setTimeout(this.reproject_.bind(this),0)}},e.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(ee),this.sourcesListenerKeys_=null},e}(Tn),Wn=function(){function t(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return t.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},t.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},t.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)},t.prototype.forEach=function(t){for(var e=this.oldest_;e;)t(e.value_,e.key_,this),e=e.newer},t.prototype.get=function(t,e){var n=this.entries_[t];return y(void 0!==n,15),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_},t.prototype.remove=function(t){var e=this.entries_[t];return y(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_},t.prototype.getCount=function(){return this.count_},t.prototype.getKeys=function(){var t,e=new Array(this.count_),n=0;for(t=this.newest_;t;t=t.older)e[n++]=t.key_;return e},t.prototype.getValues=function(){var t,e=new Array(this.count_),n=0;for(t=this.newest_;t;t=t.older)e[n++]=t.value_;return e},t.prototype.peekLast=function(){return this.oldest_.value_},t.prototype.peekLastKey=function(){return this.oldest_.key_},t.prototype.peekFirstKey=function(){return this.newest_.key_},t.prototype.pop=function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_},t.prototype.replace=function(t,e){this.get(t),this.entries_[t].value_=e},t.prototype.set=function(t,e){y(!(t in this.entries_),16);var n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_},t.prototype.setSize=function(t){this.highWaterMark=t},t}();function Yn(t,e,n,r){return void 0!==r?(r[0]=t,r[1]=e,r[2]=n,r):[t,e,n]}function Xn(t,e,n){return t+"/"+e+"/"+n}function Zn(t){return Xn(t[0],t[1],t[2])}function Kn(t){return(t[1]<<t[0])+t[2]}var Dn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Vn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dn(e,t),e.prototype.expireCache=function(t){for(;this.canExpireCache();){if(this.peekLast().getKey()in t)break;this.pop().release()}},e.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var t=function(t){return t.split("/").map(Number)}(this.peekFirstKey())[0];this.forEach(function(e){e.tileCoord[0]!==t&&(this.remove(Zn(e.tileCoord)),e.release())}.bind(this))}},e}(Wn),qn="tileloadstart",Bn="tileloadend",Hn="tileloaderror",Qn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function $n(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}var Jn=function(t){function e(e){var n=t.call(this)||this;return n.projection_=Mt(e.projection),n.attributions_=$n(e.attributions),n.attributionsCollapsible_=void 0===e.attributionsCollapsible||e.attributionsCollapsible,n.loading=!1,n.state_=void 0!==e.state?e.state:Ee,n.wrapX_=void 0!==e.wrapX&&e.wrapX,n}return Qn(e,t),e.prototype.getAttributions=function(){return this.attributions_},e.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},e.prototype.getProjection=function(){return this.projection_},e.prototype.getResolutions=function(){return h()},e.prototype.getState=function(){return this.state_},e.prototype.getWrapX=function(){return this.wrapX_},e.prototype.getContextOptions=function(){},e.prototype.refresh=function(){this.changed()},e.prototype.setAttributions=function(t){this.attributions_=$n(t),this.changed()},e.prototype.setState=function(t){this.state_=t,this.changed()},e}(ce);function tr(t,e,n){return void 0===n&&(n=[0,0]),n[0]=t[0]+2*e,n[1]=t[1]+2*e,n}function er(t,e,n){return void 0===n&&(n=[0,0]),n[0]=t[0]*e+.5|0,n[1]=t[1]*e+.5|0,n}function nr(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:(e[0]=t,e[1]=t),e)}var rr=[0,0,0],ir=function(){function t(t){var e,n,r,i;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,y((e=this.resolutions_,n=!0,r=function(t,e){return e-t}||qt,e.every((function(t,i){if(0===i)return!0;var o=r(e[i-1],t);return!(o>0||n&&0===o)}))),17),!t.origins)for(var o=0,s=this.resolutions_.length-1;o<s;++o)if(i){if(this.resolutions_[o]/this.resolutions_[o+1]!==i){i=void 0;break}}else i=this.resolutions_[o]/this.resolutions_[o+1];this.zoomFactor_=i,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,y(this.origins_.length==this.resolutions_.length,20));var a=t.extent;void 0===a||this.origin_||this.origins_||(this.origin_=xt(a)),y(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,y(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:256,y(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==a?a:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map((function(t,e){return new gn(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1))}),this):a&&this.calculateTileRanges_(a)}return t.prototype.forEachTileCoord=function(t,e,n){for(var r=this.getTileRangeForExtentAndZ(t,e),i=r.minX,o=r.maxX;i<=o;++i)for(var s=r.minY,a=r.maxY;s<=a;++s)n([e,i,s])},t.prototype.forEachTileCoordParentTileRange=function(t,e,n,r){var i,o,s=null,a=t[0]-1;for(2===this.zoomFactor_?(i=t[1],o=t[2]):s=this.getTileCoordExtent(t,r);a>=this.minZoom;){if(e(a,2===this.zoomFactor_?dn(i=Math.floor(i/2),i,o=Math.floor(o/2),o,n):this.getTileRangeForExtentAndZ(s,a,n)))return!0;--a}return!1},t.prototype.getExtent=function(){return this.extent_},t.prototype.getMaxZoom=function(){return this.maxZoom},t.prototype.getMinZoom=function(){return this.minZoom},t.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]},t.prototype.getResolution=function(t){return this.resolutions_[t]},t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.getTileCoordChildTileRange=function(t,e,n){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var r=2*t[1],i=2*t[2];return dn(r,r+1,i,i+1,e)}var o=this.getTileCoordExtent(t,n);return this.getTileRangeForExtentAndZ(o,t[0]+1,e)}return null},t.prototype.getTileRangeExtent=function(t,e,n){var r=this.getOrigin(t),i=this.getResolution(t),o=nr(this.getTileSize(t),this.tmpSize_),s=r[0]+e.minX*o[0]*i,a=r[0]+(e.maxX+1)*o[0]*i;return ct(s,r[1]+e.minY*o[1]*i,a,r[1]+(e.maxY+1)*o[1]*i,n)},t.prototype.getTileRangeForExtentAndZ=function(t,e,n){var r=rr;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,r);var i=r[1],o=r[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,r),dn(i,r[1],o,r[2],n)},t.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),n=this.getResolution(t[0]),r=nr(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*n,e[1]-(t[2]+.5)*r[1]*n]},t.prototype.getTileCoordExtent=function(t,e){var n=this.getOrigin(t[0]),r=this.getResolution(t[0]),i=nr(this.getTileSize(t[0]),this.tmpSize_),o=n[0]+t[1]*i[0]*r,s=n[1]-(t[2]+1)*i[1]*r;return ct(o,s,o+i[0]*r,s+i[1]*r,e)},t.prototype.getTileCoordForCoordAndResolution=function(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)},t.prototype.getTileCoordForXYAndResolution_=function(t,e,n,r,i){var o=this.getZForResolution(n),s=n/this.getResolution(o),a=this.getOrigin(o),u=nr(this.getTileSize(o),this.tmpSize_),c=r?.5:0,l=r?.5:0,h=Math.floor((t-a[0])/n+c),p=Math.floor((a[1]-e)/n+l),f=s*h/u[0],d=s*p/u[1];return r?(f=Math.ceil(f)-1,d=Math.ceil(d)-1):(f=Math.floor(f),d=Math.floor(d)),Yn(o,f,d,i)},t.prototype.getTileCoordForXYAndZ_=function(t,e,n,r,i){var o=this.getOrigin(n),s=this.getResolution(n),a=nr(this.getTileSize(n),this.tmpSize_),u=r?.5:0,c=r?.5:0,l=Math.floor((t-o[0])/s+u),h=Math.floor((o[1]-e)/s+c),p=l/a[0],f=h/a[1];return r?(p=Math.ceil(p)-1,f=Math.ceil(f)-1):(p=Math.floor(p),f=Math.floor(f)),Yn(n,p,f,i)},t.prototype.getTileCoordForCoordAndZ=function(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)},t.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]},t.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]},t.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:null},t.prototype.getZForResolution=function(t,e){return F(Bt(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)},t.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,n=new Array(e),r=this.minZoom;r<e;++r)n[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=n},t}();function or(t){var e=t.getDefaultTileGrid();return e||(e=function(t,e,n,r){return function(t,e,n,r){var i=void 0!==r?r:nt,o=sr(t,e,n);return new ir({extent:t,origin:yt(t,i),resolutions:o,tileSize:n})}(ar(t),e,n,r)}(t),t.setDefaultTileGrid(e)),e}function sr(t,e,n,r){for(var i=void 0!==e?e:42,o=mt(t),s=Tt(t),a=nr(void 0!==n?n:256),u=r>0?r:Math.max(s/a[0],o/a[1]),c=i+1,l=new Array(c),h=0;h<c;++h)l[h]=u/Math.pow(2,h);return l}function ar(t){var e=(t=Mt(t)).getExtent();if(!e){var n=180*C[I.DEGREES]/t.getMetersPerUnit();e=ct(-n,-n,n,n)}return e}var ur=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),cr=function(t){function e(e){var n=t.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX})||this;n.opaque_=void 0!==e.opaque&&e.opaque,n.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1,n.tileGrid=void 0!==e.tileGrid?e.tileGrid:null;var r=e.tileGrid;return r&&nr(r.getTileSize(r.getMinZoom()),[256,256]),n.tileCache=new Vn(e.cacheSize||0),n.tmpSize=[0,0],n.key_=e.key||"",n.tileOptions={transition:e.transition},n.zDirection=e.zDirection?e.zDirection:0,n}return ur(e,t),e.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},e.prototype.expireCache=function(t,e){var n=this.getTileCacheForProjection(t);n&&n.expireCache(e)},e.prototype.forEachLoadedTile=function(t,e,n,r){var i=this.getTileCacheForProjection(t);if(!i)return!1;for(var o,s,a,u=!0,c=n.minX;c<=n.maxX;++c)for(var l=n.minY;l<=n.maxY;++l)s=Xn(e,c,l),a=!1,i.containsKey(s)&&(a=(o=i.get(s)).getState()===S)&&(a=!1!==r(o)),a||(u=!1);return u},e.prototype.getGutterForProjection=function(t){return 0},e.prototype.getKey=function(){return this.key_},e.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},e.prototype.getOpaque=function(t){return this.opaque_},e.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},e.prototype.getTile=function(t,e,n,r,i){return h()},e.prototype.getTileGrid=function(){return this.tileGrid},e.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:or(t)},e.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();return e&&!Lt(e,t)?null:this.tileCache},e.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},e.prototype.getTilePixelSize=function(t,e,n){var r=this.getTileGridForProjection(n),i=this.getTilePixelRatio(e),o=nr(r.getTileSize(t),this.tmpSize);return 1==i?o:er(o,i,this.tmpSize)},e.prototype.getTileCoordForTileUrlFunction=function(t,e){var n=void 0!==e?e:this.getProjection(),r=this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(t=function(t,e,n){var r=e[0],i=t.getTileCoordCenter(e),o=ar(n);if(st(o,i))return e;var s=Tt(o),a=Math.ceil((o[0]-i[0])/s);return i[0]+=s*a,t.getTileCoordForCoordAndZ(i,r)}(r,t,n)),function(t,e){var n=t[0],r=t[1],i=t[2];if(e.getMinZoom()>n||n>e.getMaxZoom())return!1;var o,s=e.getExtent();return!(o=s?e.getTileRangeForExtentAndZ(s,n):e.getFullTileRange(n))||o.containsXY(r,i)}(t,r)?t:null},e.prototype.clear=function(){this.tileCache.clear()},e.prototype.refresh=function(){this.clear(),t.prototype.refresh.call(this)},e.prototype.updateCacheSize=function(t,e){var n=this.getTileCacheForProjection(e);t>n.highWaterMark&&(n.highWaterMark=t)},e.prototype.useTile=function(t,e,n,r){},e}(Jn),lr=function(t){function e(e,n){var r=t.call(this,e)||this;return r.tile=n,r}return ur(e,t),e}(Kt),hr=cr;function pr(t,e){var n=/\{z\}/g,r=/\{x\}/g,i=/\{y\}/g,o=/\{-y\}/g;return function(s,a,u){return s?t.replace(n,s[0].toString()).replace(r,s[1].toString()).replace(i,s[2].toString()).replace(o,(function(){var t=s[0],n=e.getFullTileRange(t);return y(n,55),(n.getHeight()-s[2]-1).toString()})):void 0}}function fr(t,e){for(var n=t.length,r=new Array(n),i=0;i<n;++i)r[i]=pr(t[i],e);return function(t){if(1===t.length)return t[0];return function(e,n,r){if(e){var i=z(Kn(e),t.length);return t[i](e,n,r)}}}(r)}var dr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),gr=function(t){function e(n){var r=t.call(this,{attributions:n.attributions,cacheSize:n.cacheSize,opaque:n.opaque,projection:n.projection,state:n.state,tileGrid:n.tileGrid,tilePixelRatio:n.tilePixelRatio,wrapX:n.wrapX,transition:n.transition,key:n.key,attributionsCollapsible:n.attributionsCollapsible,zDirection:n.zDirection})||this;return r.generateTileUrlFunction_=r.tileUrlFunction===e.prototype.tileUrlFunction,r.tileLoadFunction=n.tileLoadFunction,n.tileUrlFunction&&(r.tileUrlFunction=n.tileUrlFunction.bind(r)),r.urls=null,n.urls?r.setUrls(n.urls):n.url&&r.setUrl(n.url),r.tileLoadingKeys_={},r}return dr(e,t),e.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},e.prototype.getTileUrlFunction=function(){return this.tileUrlFunction},e.prototype.getUrls=function(){return this.urls},e.prototype.handleTileChange=function(t){var e,n=t.target,r=f(n),i=n.getState();i==T?(this.tileLoadingKeys_[r]=!0,e=qn):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],e=i==E?Hn:i==S?Bn:void 0),null!=e&&this.dispatchEvent(new lr(e,n))},e.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},e.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()},e.prototype.setUrl=function(t){var e=function(t){var e=[],n=/\{([a-z])-([a-z])\}/.exec(t);if(n){var r=n[1].charCodeAt(0),i=n[2].charCodeAt(0),o=void 0;for(o=r;o<=i;++o)e.push(t.replace(n[0],String.fromCharCode(o)));return e}if(n=/\{(\d+)-(\d+)\}/.exec(t)){for(var s=parseInt(n[2],10),a=parseInt(n[1],10);a<=s;a++)e.push(t.replace(n[0],a.toString()));return e}return e.push(t),e}(t);this.urls=e,this.setUrls(e)},e.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(fr(t,this.tileGrid),e):this.setKey(e)},e.prototype.tileUrlFunction=function(t,e,n){},e.prototype.useTile=function(t,e,n){var r=Xn(t,e,n);this.tileCache.containsKey(r)&&this.tileCache.get(r)},e}(hr),_r=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function yr(t,e){t.getImage().src=e}var vr=function(t){function e(e){var n=t.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:yr,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection})||this;return n.crossOrigin=void 0!==e.crossOrigin?e.crossOrigin:null,n.tileClass=void 0!==e.tileClass?e.tileClass:In,n.tileCacheForProjection={},n.tileGridForProjection={},n.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,n.contextOptions_=!1===e.imageSmoothing?Fn:void 0,n.renderReprojectionEdges_=!1,n}return _r(e,t),e.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},e.prototype.expireCache=function(t,e){var n=this.getTileCacheForProjection(t);for(var r in this.tileCache.expireCache(this.tileCache==n?e:{}),this.tileCacheForProjection){var i=this.tileCacheForProjection[r];i.expireCache(i==n?e:{})}},e.prototype.getContextOptions=function(){return this.contextOptions_},e.prototype.getGutterForProjection=function(t){return this.getProjection()&&t&&!Lt(this.getProjection(),t)?0:this.getGutter()},e.prototype.getGutter=function(){return 0},e.prototype.getKey=function(){return t.prototype.getKey.call(this)+(this.contextOptions_?"\n"+JSON.stringify(this.contextOptions_):"")},e.prototype.getOpaque=function(e){return!(this.getProjection()&&e&&!Lt(this.getProjection(),e))&&t.prototype.getOpaque.call(this,e)},e.prototype.getTileGridForProjection=function(t){var e=this.getProjection();if(!this.tileGrid||e&&!Lt(e,t)){var n=f(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=or(t)),this.tileGridForProjection[n]}return this.tileGrid},e.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();if(!e||Lt(e,t))return this.tileCache;var n=f(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new Vn(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]},e.prototype.createTile_=function(t,e,n,r,i,o){var s=[t,e,n],a=this.getTileCoordForTileUrlFunction(s,i),c=a?this.tileUrlFunction(a,r,i):void 0,l=new this.tileClass(s,void 0!==c?w:O,void 0!==c?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return l.key=o,l.addEventListener(u,this.handleTileChange.bind(this)),l},e.prototype.getTile=function(t,e,n,r,i){var o=this.getProjection();if(o&&i&&!Lt(o,i)){var s=this.getTileCacheForProjection(i),a=[t,e,n],u=void 0,c=Zn(a);s.containsKey(c)&&(u=s.get(c));var l=this.getKey();if(u&&u.key==l)return u;var h=this.getTileGridForProjection(o),p=this.getTileGridForProjection(i),f=this.getTileCoordForTileUrlFunction(a,i),d=new Un(o,h,i,p,a,f,this.getTilePixelRatio(r),this.getGutter(),function(t,e,n,r){return this.getTileInternal(t,e,n,r,o)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.contextOptions_);return d.key=l,u?(d.interimTile=u,d.refreshInterimChain(),s.replace(c,d)):s.set(c,d),d}return this.getTileInternal(t,e,n,r,o||i)},e.prototype.getTileInternal=function(t,e,n,r,i){var o=null,s=Xn(t,e,n),a=this.getKey();if(this.tileCache.containsKey(s)){if((o=this.tileCache.get(s)).key!=a){var u=o;o=this.createTile_(t,e,n,r,i,a),u.getState()==w?o.interimTile=u.interimTile:o.interimTile=u,o.refreshInterimChain(),this.tileCache.replace(s,o)}}else o=this.createTile_(t,e,n,r,i,a),this.tileCache.set(s,o);return o},e.prototype.setRenderReprojectionEdges=function(t){if(this.renderReprojectionEdges_!=t){for(var e in this.renderReprojectionEdges_=t,this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}},e.prototype.setTileGridForProjection=function(t,e){var n=Mt(t);if(n){var r=f(n);r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}},e}(gr),mr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),br=function(t){function e(e){var n=e||{},r=void 0!==n.projection?n.projection:"EPSG:3857",i=void 0!==n.tileGrid?n.tileGrid:function(t){var e=t||{},n=e.extent||Mt("EPSG:3857").getExtent(),r={extent:n,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:sr(n,e.maxZoom,e.tileSize,e.maxResolution)};return new ir(r)}({extent:ar(r),maxResolution:n.maxResolution,maxZoom:n.maxZoom,minZoom:n.minZoom,tileSize:n.tileSize});return t.call(this,{attributions:n.attributions,cacheSize:n.cacheSize,crossOrigin:n.crossOrigin,imageSmoothing:n.imageSmoothing,opaque:n.opaque,projection:r,reprojectionErrorThreshold:n.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:n.tileLoadFunction,tilePixelRatio:n.tilePixelRatio,tileUrlFunction:n.tileUrlFunction,url:n.url,urls:n.urls,wrapX:void 0===n.wrapX||n.wrapX,transition:n.transition,attributionsCollapsible:n.attributionsCollapsible,zDirection:n.zDirection})||this}return mr(e,t),e}(vr),xr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),wr=function(t){function e(e,n,r,i,o,s,a){var u=this,c=e.getExtent(),l=n.getExtent(),h=l?bt(r,l):r,p=kn(e,n,_t(h),i),f=new Mn(e,n,h,c,.5*p,i),d=s(f.calculateSourceExtent(),p,o),g=d?Me:ke,_=d?d.getPixelRatio():1;return(u=t.call(this,r,i,_,g)||this).targetProj_=n,u.maxSourceExtent_=c,u.triangulation_=f,u.targetResolution_=i,u.targetExtent_=r,u.sourceImage_=d,u.sourcePixelRatio_=_,u.contextOptions_=a,u.canvas_=null,u.sourceListenerKey_=null,u}return xr(e,t),e.prototype.disposeInternal=function(){this.state==Fe&&this.unlistenSource_(),t.prototype.disposeInternal.call(this)},e.prototype.getImage=function(){return this.canvas_},e.prototype.getProjection=function(){return this.targetProj_},e.prototype.reproject_=function(){var t=this.sourceImage_.getState();if(t==Ae){var e=Tt(this.targetExtent_)/this.targetResolution_,n=mt(this.targetExtent_)/this.targetResolution_;this.canvas_=Nn(e,n,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.contextOptions_)}this.state=t,this.changed()},e.prototype.load=function(){if(this.state==Me){this.state=Fe,this.changed();var t=this.sourceImage_.getState();t==Ae||t==Le?this.reproject_():(this.sourceListenerKey_=Jt(this.sourceImage_,u,(function(t){var e=this.sourceImage_.getState();e!=Ae&&e!=Le||(this.unlistenSource_(),this.reproject_())}),this),this.sourceImage_.load())}},e.prototype.unlistenSource_=function(){ee(this.sourceListenerKey_),this.sourceListenerKey_=null},e}(En),Tr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Sr="imageloadstart",Er="imageloadend",Or="imageloaderror",Pr=function(t){function e(e,n){var r=t.call(this,e)||this;return r.image=n,r}return Tr(e,t),e}(Kt);function jr(t,e){t.getImage().src=e}var Rr=function(t){function e(e){var n=t.call(this,{attributions:e.attributions,projection:e.projection,state:e.state})||this;return n.resolutions_=void 0!==e.resolutions?e.resolutions:null,n.reprojectedImage_=null,n.reprojectedRevision_=0,n.contextOptions_=!1===e.imageSmoothing?Fn:void 0,n}return Tr(e,t),e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.getContextOptions=function(){return this.contextOptions_},e.prototype.findNearestResolution=function(t){if(this.resolutions_){var e=Bt(this.resolutions_,t,0);t=this.resolutions_[e]}return t},e.prototype.getImage=function(t,e,n,r){var i=this.getProjection();if(i&&r&&!Lt(i,r)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Lt(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==e&&ht(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new wr(i,r,t,e,n,function(t,e,n){return this.getImageInternal(t,e,n,i)}.bind(this),this.contextOptions_),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}return i&&(r=i),this.getImageInternal(t,e,n,r)},e.prototype.getImageInternal=function(t,e,n,r){return h()},e.prototype.handleImageChange=function(t){var e=t.target;switch(e.getState()){case Fe:this.loading=!0,this.dispatchEvent(new Pr(Sr,e));break;case Ae:this.loading=!1,this.dispatchEvent(new Pr(Er,e));break;case Le:this.loading=!1,this.dispatchEvent(new Pr(Or,e))}},e}(Jn),Cr="carmentaserver",Ir="geoserver",Mr="mapserver",Fr="qgis";function Ar(t,e){var n=[];Object.keys(e).forEach((function(t){null!==e[t]&&void 0!==e[t]&&n.push(t+"="+encodeURIComponent(e[t]))}));var r=n.join("&");return(t=-1===(t=t.replace(/[?&]$/,"")).indexOf("?")?t+"?":t+"&")+r}var Lr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),kr=[101,101],zr=function(t){function e(e){var n=this,r=e||{};return(n=t.call(this,{attributions:r.attributions,imageSmoothing:r.imageSmoothing,projection:r.projection,resolutions:r.resolutions})||this).crossOrigin_=void 0!==r.crossOrigin?r.crossOrigin:null,n.url_=r.url,n.imageLoadFunction_=void 0!==r.imageLoadFunction?r.imageLoadFunction:jr,n.params_=r.params||{},n.v13_=!0,n.updateV13_(),n.serverType_=r.serverType,n.hidpi_=void 0===r.hidpi||r.hidpi,n.image_=null,n.imageSize_=[0,0],n.renderedRevision_=0,n.ratio_=void 0!==r.ratio?r.ratio:1.5,n}return Lr(e,t),e.prototype.getFeatureInfoUrl=function(t,e,n,r){if(void 0!==this.url_){var i=Mt(n),o=this.getProjection();o&&o!==i&&(e=kn(o,i,t,e),t=Nt(t,i,o));var s=vt(t,e,0,kr),a={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};v(a,this.params_,r);var u=Math.floor((t[0]-s[0])/e),c=Math.floor((s[3]-t[1])/e);return a[this.v13_?"I":"X"]=u,a[this.v13_?"J":"Y"]=c,this.getRequestUrl_(s,kr,1,o||i,a)}},e.prototype.getLegendUrl=function(t,e){if(void 0!==this.url_){var n={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===e||void 0===e.LAYER){var r=this.params_.LAYERS;if(!(!Array.isArray(r)||1===r.length))return;n.LAYER=r}if(void 0!==t){var i=this.getProjection()?this.getProjection().getMetersPerUnit():1;n.SCALE=t*i*39.37*(25.4/.28)}return v(n,e),Ar(this.url_,n)}},e.prototype.getParams=function(){return this.params_},e.prototype.getImageInternal=function(t,e,n,r){if(void 0===this.url_)return null;e=this.findNearestResolution(e),1==n||this.hidpi_&&void 0!==this.serverType_||(n=1);var i=e/n,o=_t(t),s=vt(o,i,0,[Math.ceil(Tt(t)/i),Math.ceil(mt(t)/i)]),a=vt(o,i,0,[Math.ceil(this.ratio_*Tt(t)/i),Math.ceil(this.ratio_*mt(t)/i)]),c=this.image_;if(c&&this.renderedRevision_==this.getRevision()&&c.getResolution()==e&&c.getPixelRatio()==n&&at(c.getExtent(),s))return c;var l={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};v(l,this.params_),this.imageSize_[0]=Math.round(Tt(a)/i),this.imageSize_[1]=Math.round(mt(a)/i);var h=this.getRequestUrl_(a,this.imageSize_,n,r,l);return this.image_=new jn(a,e,n,h,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),this.image_.addEventListener(u,this.handleImageChange.bind(this)),this.image_},e.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},e.prototype.getRequestUrl_=function(t,e,n,r,i){if(y(void 0!==this.url_,9),i[this.v13_?"CRS":"SRS"]=r.getCode(),"STYLES"in this.params_||(i.STYLES=""),1!=n)switch(this.serverType_){case Ir:var o=90*n+.5|0;"FORMAT_OPTIONS"in i?i.FORMAT_OPTIONS+=";dpi:"+o:i.FORMAT_OPTIONS="dpi:"+o;break;case Mr:i.MAP_RESOLUTION=90*n;break;case Cr:case Fr:i.DPI=90*n;break;default:y(!1,8)}i.WIDTH=e[0],i.HEIGHT=e[1];var s,a=r.getAxisOrientation();return s=this.v13_&&"ne"==a.substr(0,2)?[t[1],t[0],t[3],t[2]]:t,i.BBOX=s.join(","),Ar(this.url_,i)},e.prototype.getUrl=function(){return this.url_},e.prototype.setImageLoadFunction=function(t){this.image_=null,this.imageLoadFunction_=t,this.changed()},e.prototype.setUrl=function(t){t!=this.url_&&(this.url_=t,this.image_=null,this.changed())},e.prototype.updateParams=function(t){v(this.params_,t),this.updateV13_(),this.image_=null,this.changed()},e.prototype.updateV13_=function(){var t=this.params_.VERSION||"1.3.0";this.v13_=jt(t,"1.3")>=0},e}(Rr),Nr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Gr=function(t){function e(e){var n=this,r=e||{},i=r.params||{},o=!("TRANSPARENT"in i)||i.TRANSPARENT;return(n=t.call(this,{attributions:r.attributions,cacheSize:r.cacheSize,crossOrigin:r.crossOrigin,imageSmoothing:r.imageSmoothing,opaque:!o,projection:r.projection,reprojectionErrorThreshold:r.reprojectionErrorThreshold,tileClass:r.tileClass,tileGrid:r.tileGrid,tileLoadFunction:r.tileLoadFunction,url:r.url,urls:r.urls,wrapX:void 0===r.wrapX||r.wrapX,transition:r.transition})||this).gutter_=void 0!==r.gutter?r.gutter:0,n.params_=i,n.v13_=!0,n.serverType_=r.serverType,n.hidpi_=void 0===r.hidpi||r.hidpi,n.tmpExtent_=[1/0,1/0,-1/0,-1/0],n.updateV13_(),n.setKey(n.getKeyForParams_()),n}return Nr(e,t),e.prototype.getFeatureInfoUrl=function(t,e,n,r){var i=Mt(n),o=this.getProjection(),s=this.getTileGrid();s||(s=this.getTileGridForProjection(i));var a=s.getZForResolution(e,this.zDirection),u=s.getTileCoordForCoordAndZ(t,a);if(!(s.getResolutions().length<=u[0])){var c=s.getResolution(u[0]),l=s.getTileCoordExtent(u,this.tmpExtent_),h=nr(s.getTileSize(u[0]),this.tmpSize),p=this.gutter_;0!==p&&(h=tr(h,p,this.tmpSize),l=ot(l,c*p,l)),o&&o!==i&&(c=kn(o,i,t,c),l=Gt(l,i,o),t=Nt(t,i,o));var f={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};v(f,this.params_,r);var d=Math.floor((t[0]-l[0])/c),g=Math.floor((l[3]-t[1])/c);return f[this.v13_?"I":"X"]=d,f[this.v13_?"J":"Y"]=g,this.getRequestUrl_(u,h,l,1,o||i,f)}},e.prototype.getLegendUrl=function(t,e){if(void 0!==this.urls[0]){var n={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===e||void 0===e.LAYER){var r=this.params_.LAYERS;if(!(!Array.isArray(r)||1===r.length))return;n.LAYER=r}if(void 0!==t){var i=this.getProjection()?this.getProjection().getMetersPerUnit():1;n.SCALE=t*i*39.37*(25.4/.28)}return v(n,e),Ar(this.urls[0],n)}},e.prototype.getGutter=function(){return this.gutter_},e.prototype.getParams=function(){return this.params_},e.prototype.getRequestUrl_=function(t,e,n,r,i,o){var s=this.urls;if(s){if(o.WIDTH=e[0],o.HEIGHT=e[1],o[this.v13_?"CRS":"SRS"]=i.getCode(),"STYLES"in this.params_||(o.STYLES=""),1!=r)switch(this.serverType_){case Ir:var a=90*r+.5|0;"FORMAT_OPTIONS"in o?o.FORMAT_OPTIONS+=";dpi:"+a:o.FORMAT_OPTIONS="dpi:"+a;break;case Mr:o.MAP_RESOLUTION=90*r;break;case Cr:case Fr:o.DPI=90*r;break;default:y(!1,52)}var u,c=i.getAxisOrientation(),l=n;if(this.v13_&&"ne"==c.substr(0,2)){var h=void 0;h=n[0],l[0]=n[1],l[1]=h,h=n[2],l[2]=n[3],l[3]=h}if(o.BBOX=l.join(","),1==s.length)u=s[0];else u=s[z(Kn(t),s.length)];return Ar(u,o)}},e.prototype.getTilePixelRatio=function(t){return this.hidpi_&&void 0!==this.serverType_?t:1},e.prototype.getKeyForParams_=function(){var t=0,e=[];for(var n in this.params_)e[t++]=n+"-"+this.params_[n];return e.join("/")},e.prototype.updateParams=function(t){v(this.params_,t),this.updateV13_(),this.setKey(this.getKeyForParams_())},e.prototype.updateV13_=function(){var t=this.params_.VERSION||"1.3.0";this.v13_=jt(t,"1.3")>=0},e.prototype.tileUrlFunction=function(t,e,n){var r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(n)),!(r.getResolutions().length<=t[0])){1==e||this.hidpi_&&void 0!==this.serverType_||(e=1);var i=r.getResolution(t[0]),o=r.getTileCoordExtent(t,this.tmpExtent_),s=nr(r.getTileSize(t[0]),this.tmpSize),a=this.gutter_;0!==a&&(s=tr(s,a,this.tmpSize),o=ot(o,i*a,o)),1!=e&&(s=er(s,e,this.tmpSize));var u={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};return v(u,this.params_),this.getRequestUrl_(t,s,o,e,n,u)}},e}(vr),Ur=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Wr=function(t){function e(e){var n=e||{};return t.call(this,n)||this}return Ur(e,t),e}(Pe),Yr=0,Xr=1,Zr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Kr=function(t){function e(e){var n=t.call(this,e)||this;return n.image_=null,n}return Zr(e,t),e.prototype.getImage=function(){return this.image_?this.image_.getImage():null},e.prototype.prepareFrame=function(t){var e=t.layerStatesArray[t.layerIndex],n=t.pixelRatio,r=t.viewState,i=r.resolution,o=this.getLayer().getSource(),s=t.viewHints,a=t.extent;if(void 0!==e.extent&&(a=bt(a,Zt(e.extent,r.projection))),!s[Yr]&&!s[Xr]&&!Et(a))if(o){var u=r.projection,c=o.getImage(a,i,n,u);c&&this.loadImage(c)&&(this.image_=c)}else this.image_=null;return!!this.image_},e.prototype.renderFrame=function(t,e){var n=this.image_,r=n.getExtent(),i=n.getResolution(),o=n.getPixelRatio(),s=t.layerStatesArray[t.layerIndex],a=t.pixelRatio,u=t.viewState,c=u.center,l=u.resolution,h=t.size,p=a*i/(l*o),f=Math.round(h[0]*a),d=Math.round(h[1]*a),g=u.rotation;if(g){var _=Math.round(Math.sqrt(f*f+d*d));f=_,d=_}Ye(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/a,1/a,g,-f/2,-d/2),Xe(this.inversePixelTransform,this.pixelTransform);var y=ln(this.pixelTransform);this.useContainer(e,y,s.opacity);var m=this.context,b=m.canvas;b.width!=f||b.height!=d?(b.width=f,b.height=d):this.containerReused||m.clearRect(0,0,f,d);var x=!1;if(s.extent){var w=Zt(s.extent,u.projection);(x=!at(w,t.extent)&&St(w,t.extent))&&this.clipUnrotated(m,t,w)}var T=n.getImage(),S=Ye(this.tempTransform,f/2,d/2,p,p,0,o*(r[0]-c[0])/i,o*(c[1]-r[3])/i);this.renderedResolution=i*a/o;var E=S[4],O=S[5],P=T.width*S[0],j=T.height*S[3];if(v(m,this.getLayer().getSource().getContextOptions()),this.preRender(m,t),P>=.5&&j>=.5){var R=s.opacity,C=void 0;1!==R&&(C=this.context.globalAlpha,this.context.globalAlpha=R),this.context.drawImage(T,0,0,+T.width,+T.height,Math.round(E),Math.round(O),Math.round(P),Math.round(j)),1!==R&&(this.context.globalAlpha=C)}return this.postRender(m,t),x&&m.restore(),y!==b.style.transform&&(b.style.transform=y),this.container},e}(pn),Dr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Vr=function(t){function e(e){return t.call(this,e)||this}return Dr(e,t),e.prototype.createRenderer=function(){return new Kr(this)},e}(Wr),qr=n(2),Br=n(32),Hr=new(n(31).a)(Br.a),Qr=n(11);function $r(t){var e=t.subscriber,n=t.counter,r=t.period;e.next(n),this.schedule({subscriber:e,counter:n+1,period:r},r)}var Jr=n(0),ti=n(30),ei=n(10),ni=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return Jr.a(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new ei.a;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(ti.a),ri=n(45),ii=n(38),oi=n(13),si=n(1),ai=n(6),ui={leading:!0,trailing:!1};ai.b;var ci=function(){function t(t,e,n,r){this.duration=t,this.scheduler=e,this.leading=n,this.trailing=r}return t.prototype.call=function(t,e){return e.subscribe(new li(t,this.duration,this.scheduler,this.leading,this.trailing))},t}(),li=function(t){function e(e,n,r,i,o){var s=t.call(this,e)||this;return s.duration=n,s.scheduler=r,s.leading=i,s.trailing=o,s._hasTrailingValue=!1,s._trailingValue=null,s}return Jr.a(e,t),e.prototype._next=function(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(hi,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))},e.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},e.prototype.clearThrottle=function(){var t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)},e}(si.a);function hi(t){t.subscriber.clearThrottle()}const pi=(void 0===(fi=500)&&(fi=0),void 0===di&&(di=Hr),gi=fi,(Object(Qr.a)(gi)||!(gi-parseFloat(gi)+1>=0)||fi<0)&&(fi=0),di&&"function"==typeof di.schedule||(di=Hr),new qr.a((function(t){return t.add(di.schedule($r,fi,{subscriber:t,counter:0,period:fi})),t})));var fi,di,gi;function _i(t,e){switch(t.type){case"XYZ":return function(t,e){return yi(new br({crossOrigin:"anonymous",url:t.url,transition:0}),e,t.opacity)}(t,e);case"WMS":return function(t,e){if(t.tiled)return yi(new Gr({crossOrigin:"anonymous",url:t.url,params:{LAYERS:t.layer,TILED:!0},transition:0}),e,t.opacity);const n=e.size[0],r=e.size[1],i=qe(n,r);let o,a,u;i.canvas.style={},a=new Vr({transition:0,source:new zr({crossOrigin:"anonymous",url:t.url,params:{LAYERS:t.layer},ratio:1})}),a.getSource().setImageLoadFunction((function(t,e){const i=t.getImage();s()&&i.hintImageSize(n,r),i.src=e})),o={...e,layerStatesArray:[{layer:a,managed:!0,maxResolution:null,maxZoom:null,minResolution:0,minZoom:null,opacity:void 0!==t.opacity?t.opacity:1,sourceState:"ready",visible:!0,zIndex:0}]},u=a.getRenderer(),u.useContainer=function(){this.containerReused=!1,this.canvas=i.canvas,this.context=i,this.container={firstElementChild:i.canvas}};const c=new ni([0,null]);return a.getSource().once("imageloadend",()=>{u.prepareFrame({...o,time:Date.now()}),u.renderFrame({...o,time:Date.now()},i.canvas),c.next([1,i.canvas]),c.complete()}),u.prepareFrame({...o,time:Date.now()}),c}(t,e)}}function yi(t,e,n){const r=qe(e.size[0],e.size[1]);let i,o,a;r.canvas.style={},o=new bn({transition:0,source:t}),o.getSource().setTileLoadFunction((function(t,n){const r=t.getImage();if(s()){const t=o.getSource().getTilePixelSize(0,e.pixelRatio,e.viewState.projection);r.hintImageSize(t[0],t[1])}r.src=n})),i={...e,layerStatesArray:[{layer:o,managed:!0,maxResolution:null,maxZoom:null,minResolution:0,minZoom:null,opacity:void 0!==n?n:1,sourceState:"ready",visible:!0,zIndex:0}]},a=o.getRenderer(),a.useContainer=function(){this.containerReused=!1,this.canvas=r.canvas,this.context=r,this.container={firstElementChild:r.canvas}},a.renderFrame({...i,time:Date.now()},r.canvas);const u=Object.keys(i.tileQueue.queuedElements_).length;return pi.pipe(Object(ri.a)(!0),Object(ii.a)(()=>(i.tileQueue.reprioritize(),i.tileQueue.loadMoreTiles(12,4),i.tileQueue.getTilesLoading()),!0),Object(oi.a)(()=>{let t=1-Object.keys(i.tileQueue.queuedElements_).length/u;return 1===t&&i.tileQueue.getTilesLoading()>0&&(t-=.001),1===t?(a.renderFrame({...i,time:Date.now()},r.canvas),[1,r.canvas]):[t,null]}),function(t,e,n){return void 0===e&&(e=Hr),void 0===n&&(n=ui),function(r){return r.lift(new ci(t,e,n.leading,n.trailing))}}(500,void 0,{leading:!0,trailing:!0}))}var vi=n(16),mi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Jr.a(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(si.a),bi=function(t){function e(e,n,r){var i=t.call(this)||this;return i.parent=e,i.outerValue=n,i.outerIndex=r,i.index=0,i}return Jr.a(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(si.a),xi=n(17);function wi(t,e,n,r,i){if(void 0===i&&(i=new bi(t,n,r)),!i.closed)return e instanceof qr.a?e.subscribe(i):Object(xi.a)(e)(i)}var Ti=n(25),Si={};var Ei=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Oi(t,this.resultSelector))},t}(),Oi=function(t){function e(e,n){var r=t.call(this,e)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return Jr.a(e,t),e.prototype._next=function(t){this.values.push(Si),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var n=0;n<e;n++){var r=t[n];this.add(wi(this,r,void 0,n))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n){var r=this.values,i=r[n],o=this.toRespond?i===Si?--this.toRespond:this.toRespond:0;r[n]=e,0===o&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(mi),Pi=n(28),ji=n(35),Ri=n(26);var Ci=n(5);var Ii="postrender",Mi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Fi=function(t){function e(e){var n=t.call(this)||this,r=e.element;return!r||e.target||r.style.pointerEvents||(r.style.pointerEvents="auto"),n.element=r||null,n.target_=null,n.map_=null,n.listenerKeys=[],e.render&&(n.render=e.render),e.target&&n.setTarget(e.target),n}return Mi(e,t),e.prototype.disposeInternal=function(){Be(this.element),t.prototype.disposeInternal.call(this)},e.prototype.getMap=function(){return this.map_},e.prototype.setMap=function(t){this.map_&&Be(this.element);for(var e=0,n=this.listenerKeys.length;e<n;++e)ee(this.listenerKeys[e]);(this.listenerKeys.length=0,this.map_=t,this.map_)&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Ht&&this.listenerKeys.push(Jt(t,Ii,this.render,this)),t.render())},e.prototype.render=function(t){},e.prototype.setTarget=function(t){this.target_="string"==typeof t?document.getElementById(t):t},e}(ce),Ai=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Li="degrees",ki="imperial",zi="nautical",Ni="metric",Gi="us",Ui=[1,2,5];!function(t){function e(e){var n=this,r=e||{},i=void 0!==r.className?r.className:r.bar?"ol-scale-bar":"ol-scale-line";return(n=t.call(this,{element:document.createElement("div"),render:r.render,target:r.target})||this).innerElement_=document.createElement("div"),n.innerElement_.className=i+"-inner",n.element.className=i+" ol-unselectable",n.element.appendChild(n.innerElement_),n.viewState_=null,n.minWidth_=void 0!==r.minWidth?r.minWidth:64,n.renderedVisible_=!1,n.renderedWidth_=void 0,n.renderedHTML_="",n.addEventListener(ue("units"),n.handleUnitsChanged_),n.setUnits(r.units||Ni),n.scaleBar_=r.bar||!1,n.scaleBarSteps_=r.steps||4,n.scaleBarText_=r.text||!1,n.dpi_=r.dpi||void 0,n}Ai(e,t),e.prototype.getUnits=function(){return this.get("units")},e.prototype.handleUnitsChanged_=function(){this.updateElement_()},e.prototype.setUnits=function(t){this.set("units",t)},e.prototype.setDpi=function(t){this.dpi_=t},e.prototype.updateElement_=function(){var t=this.viewState_;if(t){var e=t.center,n=t.projection,r=this.getUnits(),i=r==Li?I.DEGREES:I.METERS,o=Ft(n,t.resolution,e,i),s=this.minWidth_*(this.dpi_||25.4/.28)/(25.4/.28),a=s*o,u="";if(r==Li){var c=C[I.DEGREES];(a*=c)<c/60?(u="",o*=3600):a<c?(u="",o*=60):u=""}else r==ki?a<.9144?(u="in",o/=.0254):a<1609.344?(u="ft",o/=.3048):(u="mi",o/=1609.344):r==zi?(o/=1852,u="nm"):r==Ni?a<.001?(u="m",o*=1e6):a<1?(u="mm",o*=1e3):a<1e3?u="m":(u="km",o/=1e3):r==Gi?a<.9144?(u="in",o*=39.37):a<1609.344?(u="ft",o/=.30480061):(u="mi",o/=1609.3472):y(!1,33);for(var l,h,p,f,d=3*Math.floor(Math.log(s*o)/Math.log(10));;){p=Math.floor(d/3);var g=Math.pow(10,p);if(l=Ui[(d%3+3)%3]*g,h=Math.round(l/o),isNaN(h))return this.element.style.display="none",void(this.renderedVisible_=!1);if(h>=s)break;++d}f=this.scaleBar_?this.createScaleBar(h,l,u):l.toFixed(p<0?-p:0)+" "+u,this.renderedHTML_!=f&&(this.innerElement_.innerHTML=f,this.renderedHTML_=f),this.renderedWidth_!=h&&(this.innerElement_.style.width=h+"px",this.renderedWidth_=h),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},e.prototype.createScaleBar=function(t,e,n){for(var r="1 : "+Math.round(this.getScaleForResolution()).toLocaleString(),i=[],o=t/this.scaleBarSteps_,s="#ffffff",a=0;a<this.scaleBarSteps_;a++)0===a&&i.push(this.createMarker("absolute",a)),i.push('<div><div class="ol-scale-singlebar" style="width: '+o+"px;background-color: "+s+';"></div>'+this.createMarker("relative",a)+(a%2==0||2===this.scaleBarSteps_?this.createStepText(a,t,!1,e,n):"")+"</div>"),a===this.scaleBarSteps_-1&&i.push(this.createStepText(a+1,t,!0,e,n)),s="#ffffff"===s?"#000000":"#ffffff";return'<div style="display: flex;">'+(this.scaleBarText_?'<div class="ol-scale-text" style="width: '+t+'px;">'+r+"</div>":"")+i.join("")+"</div>"},e.prototype.createMarker=function(t,e){return'<div class="ol-scale-step-marker" style="position: '+t+";top: "+("absolute"===t?3:-10)+'px;"></div>'},e.prototype.createStepText=function(t,e,n,r,i){var o=(0===t?0:Math.round(r/this.scaleBarSteps_*t*100)/100)+(0===t?"":" "+i);return'<div class="ol-scale-step-text" style="margin-left: '+(0===t?-3:e/this.scaleBarSteps_*-1)+"px;text-align: "+(0===t?"left":"center")+"; min-width: "+(0===t?0:e/this.scaleBarSteps_*2)+"px;left: "+(n?e+"px":"unset")+';">'+o+"</div>"},e.prototype.getScaleForResolution=function(){var t=Ft(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center),e=this.dpi_||25.4/.28,n=this.viewState_.projection.getMetersPerUnit();return parseFloat(t.toString())*n*39.37*e},e.prototype.render=function(t){var e=t.frameState;this.viewState_=e?e.viewState:null,this.updateElement_()}}(Fi);function Wi(t,e,n){!function(t,e,n,r){const i="1 / "+r.scale,o=n.width,s=n.scalenumber,a=n.suffix,u=`${s} ${a}`,c=t.measureText(u).width,l=(r.scaleBar.template?r.scaleBar.template:"Scale: {mapScale}").replace("{mapScale}",i),h=t.measureText(l).width,p=Math.max(o+c,h),f="bottom-right"===r.scaleBar.position?e.size[0]-p-20:10;t.save(),t.globalAlpha=.8;const d=o+f,g=t.canvas.height-10,_=f+1*o/4,y=_+1*o/4,v=y+1*o/4,m=v+1*o/4;t.beginPath(),t.textAlign="left",t.strokeStyle="#ffffff",t.fillStyle="#000000",t.lineWidth=5,t.font="12px Arial",t.strokeText([l],f,g-12),t.fillText([l],f,g-12),t.strokeText([u],d+5,g+6),t.fillText([u],d+5,g+6),t.beginPath(),t.lineWidth=8,t.strokeStyle="#000000",t.moveTo(f,g),t.lineTo(d+1,g),t.stroke(),t.beginPath(),t.lineWidth=6,t.strokeStyle="#000000",t.moveTo(f,g),t.lineTo(_,g),t.stroke(),t.beginPath(),t.lineWidth=6,t.strokeStyle="#FFFFFF",t.moveTo(_,g),t.lineTo(y,g),t.stroke(),t.beginPath(),t.lineWidth=6,t.strokeStyle="#000000",t.moveTo(y,g),t.lineTo(v,g),t.stroke(),t.beginPath(),t.lineWidth=6,t.strokeStyle="#FFFFFF",t.moveTo(v,g),t.lineTo(m,g),t.stroke(),t.restore()}(t,e,function(t,e){const n=[1,2,5],r=t.viewState.center,i=t.viewState.projection,o=e.scaleBar.units?e.scaleBar.units:"metric",s=o==Li?I.DEGREES:I.METERS;let a=Ft(i,t.viewState.resolution,r,s),u=64*a,c="";if(o==Li){const t=C[I.DEGREES];u*=t,u<t/60?(c="",a*=3600):u<t?(c="",a*=60):c=""}else o==ki?u<.9144?(c="in",a/=.0254):u<1609.344?(c="ft",a/=.3048):(c="mi",a/=1609.344):o==zi?(a/=1852,c="nm"):o==Ni?u<.001?(c="m",a*=1e6):u<1?(c="mm",a*=1e3):u<1e3?c="m":(c="km",a/=1e3):o==Gi?u<.9144?(c="in",a*=39.37):u<1609.344?(c="ft",a/=.30480061):(c="mi",a/=1609.3472):console.error("Invalid units: Please verify your scaleBar object");let l,h,p,f=3*Math.floor(Math.log(64*a)/Math.log(10));for(;;){p=Math.floor(f/3);const t=Math.pow(10,p);if(l=n[(f%3+3)%3]*t,h=Math.round(l/a),isNaN(h))return;if(h>=64)break;++f}return{width:h,scalenumber:l,suffix:c}}(e,n),n)}let Yi=0;function Xi(t){const e=function(t){const{size:e,dpi:n}=t;if(!e[2]||"px"===e[2])return e;let r,i;switch(e[2]){case"in":r=n*e[0],i=n*e[1];break;case"cm":r=n*e[0]/Ci.a,i=n*e[1]/Ci.a;break;case"mm":r=n*e[0]/(10*Ci.a),i=n*e[1]/(10*Ci.a);break;case"m":r=n*e[0]*100/Ci.a,i=n*e[1]*100/Ci.a;break;default:r=e[0],i=e[1]}return[Math.round(r),Math.round(i)]}(t),n=function(t,e){const n=Mt(t.projection),r=t.scale/t.dpi/39.3701/n.getMetersPerUnit(),i={center:(s=t.center,a=n,Nt(s,"EPSG:4326",void 0!==a?a:"EPSG:3857")),resolution:r,projection:n,rotation:0},o={animate:!1,coordinateToPixelTransform:[1,0,0,1,0,0],declutterItems:[],extent:vt(i.center,i.resolution,i.rotation,e),index:0,layerIndex:0,layerStatesArray:[],pixelRatio:1,pixelToCoordinateTransform:[1,0,0,1,0,0],postRenderFunctions:[],size:e,time:Date.now(),usedTiles:{},viewState:i,viewHints:[0,0],wantedTiles:{}};var s,a;return o.tileQueue=new j((t,e,n,r)=>function(t,e,n,r,i){if(!t||!(n in t.wantedTiles))return 1/0;if(!t.wantedTiles[n][e.getKey()])return 1/0;var o=t.viewState.center,s=r[0]-o[0],a=r[1]-o[1];return 65536*Math.log(i)+Math.sqrt(s*s+a*a)/i}(o,t,e,n,r),()=>{}),o}(t,e),r={id:Yi++,spec:t,status:"pending",progress:0},i=qe(e[0],e[1]);(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=void 0,r=void 0;return Object(vi.a)(t[t.length-1])&&(r=t.pop()),"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&Object(Qr.a)(t[0])&&(t=t[0]),Object(Ti.a)(t,r).lift(new Ei(n))})(t.layers.map(t=>_i(t,n))).pipe(Object(ji.a)(e=>{if(e.every(([t])=>1===t)){for(let t=0;t<e.length;t++)i.drawImage(e[t][1],0,0);return t.northArrow&&function(t,e){!0===e&&(e="top-right");let n=t.canvas.width-51-10,r=10;const i=e.split("-");"bottom"===i[0]&&(r=t.canvas.height-72-10),i.length>1&&"left"===i[1]&&(n=10),t.save(),t.translate(n,r),t.fillStyle="#000000";const o=new Path2D("M 0.00,51.40C 0.00,51.40 25.50,0.00 25.50,0.00  25.50,0.00 51.00,51.40 51.00,51.40  51.00,51.40 25.50,38.60 25.50,38.60  25.50,38.60 0.00,51.40 0.00,51.40 Z");t.fill(o);const s=new Path2D("M 16.17,51.90  C 16.17,51.90 21.93,51.90 21.93,51.90    21.93,51.90 29.37,63.00 29.37,63.00    29.37,63.00 29.37,51.90 29.37,51.90    29.37,51.90 35.22,51.90 35.22,51.90    35.22,51.90 35.22,72.00 35.22,72.00    35.22,72.00 29.37,72.00 29.37,72.00    29.37,72.00 21.93,61.00 21.93,61.00    21.93,61.00 21.93,72.00 21.93,72.00    21.93,72.00 16.17,72.00 16.17,72.00    16.17,72.00 16.17,51.90 16.17,51.90 Z");t.fill(s),t.restore()}(i,t.northArrow),t.scaleBar&&Wi(i,n,t),(r=i.canvas,s()?Object(Ri.a)(r.convertToBlob()):new qr.a(t=>{r.toBlob(e=>{t.next(e),t.complete()},"image/png")})).pipe(Object(oi.a)(t=>[1,t]))}{const t=e.reduce((t,[e])=>e+t,0)/e.length,n=parseFloat(t.toFixed(4));return Object(Pi.a)([n,null])}var r}),Object(oi.a)(([t,e])=>({...r,progress:t,imageBlob:e,status:1===t?"finished":"ongoing"})),Object(ii.a)(t=>t.progress<1,!0)).subscribe(t=>{return e=Ci.c,n={status:t},void(s()?self.clients.matchAll({type:"window"}).then(t=>{t&&t.length&&t[0].postMessage({...n,type:e})}):window.dispatchEvent(new CustomEvent("inkmap.toMain",{detail:{...n,type:e}})));var e,n})}a.subscribe(t=>{switch(t.type){case Ci.b:Xi(t.spec);break;default:console.log("Unhandled message",t)}})},function(t,e){class n extends HTMLElement{constructor(){super(),this.working_=!1,this.progress_=null,this.startBtn=null,this.waitBtn=null,this.progressBar=null,this.progressBarInner=null}set working(t){this.working_=t,t||(this.progress_=null),this.refreshDOM()}set progress(t){this.progress_=t,this.refreshDOM()}connectedCallback(){this.innerHTML=`\n<button role="button" class="start-btn btn btn-primary btn-block">\n  ${this.innerHTML.trim()}\n</button>\n<button\n  role="button"\n  disabled\n  class="wait-btn btn btn-primary btn-block mt-0"\n>\n  <span\n    class="spinner-border spinner-border-sm"\n    role="status"\n    aria-hidden="true"\n  ></span>\n  Working...\n</button>\n<div class="progress mt-1" style="height: 5px">\n  <div\n    class="progress-bar"\n    style="width: 0"\n    role="progressbar"\n    aria-valuemin="0"\n    aria-valuemax="100"\n  ></div>\n</div>`,this.startBtn=this.querySelector(".start-btn"),this.waitBtn=this.querySelector(".wait-btn"),this.progressBar=this.querySelector(".progress"),this.progressBarInner=this.progressBar.children.item(0),this.refreshDOM()}refreshDOM(){"number"!=typeof this.progress_?(this.progressBar.style.visibility="hidden",this.progressBarInner.style.width="0"):(this.progressBar.style.visibility="visible",this.progressBarInner.style.width=Math.round(100*this.progress_)+"%"),this.waitBtn.style.display=this.working_?null:"none",this.startBtn.style.display=this.working_?"none":null}}customElements.define("custom-button",n)},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(0),i=n(13),o=n(26),s=n(6);function a(t,e){return"function"==typeof e?function(n){return n.pipe(a((function(n,r){return Object(o.a)(t(n,r)).pipe(Object(i.a)((function(t,i){return e(n,t,r,i)})))})))}:function(e){return e.lift(new u(t))}}var u=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.project))},t}(),c=function(t){function e(e,n){var r=t.call(this,e)||this;return r.project=n,r.index=0,r}return r.a(e,t),e.prototype._next=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this._innerSub(e)},e.prototype._innerSub=function(t){var e=this.innerSubscription;e&&e.unsubscribe();var n=new s.a(this),r=this.destination;r.add(n),this.innerSubscription=Object(s.c)(t,n),this.innerSubscription!==n&&r.add(this.innerSubscription)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=void 0},e.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t){this.destination.next(t)},e}(s.b)},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(2),i=n(11),o=n(8),s=n(13);function a(t,e,n,u){return Object(o.a)(n)&&(u=n,n=void 0),u?a(t,e,n).pipe(Object(s.a)((function(t){return Object(i.a)(t)?u.apply(void 0,t):u(t)}))):new r.a((function(r){!function t(e,n,r,i,o){var s;if(function(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(e)){var a=e;e.addEventListener(n,r,o),s=function(){return a.removeEventListener(n,r,o)}}else if(function(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(e)){var u=e;e.on(n,r),s=function(){return u.off(n,r)}}else if(function(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(e)){var c=e;e.addListener(n,r),s=function(){return c.removeListener(n,r)}}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var l=0,h=e.length;l<h;l++)t(e[l],n,r,i,o)}i.add(s)}(t,e,(function(t){arguments.length>1?r.next(Array.prototype.slice.call(arguments)):r.next(t)}),r,n)}))}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(13);function i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.length;if(0===n)throw new Error("list of properties cannot be empty.");return function(e){return Object(r.a)(o(t,n))(e)}}function o(t,e){return function(n){for(var r=n,i=0;i<e;i++){var o=null!=r?r[t[i]]:void 0;if(void 0===o)return;r=o}return r}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(0),i=n(1);function o(t,e){return void 0===e&&(e=!1),function(n){return n.lift(new s(t,e))}}var s=function(){function t(t,e){this.predicate=t,this.inclusive=e}return t.prototype.call=function(t,e){return e.subscribe(new a(t,this.predicate,this.inclusive))},t}(),a=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.inclusive=r,i.index=0,i}return r.a(e,t),e.prototype._next=function(t){var e,n=this.destination;try{e=this.predicate(t,this.index++)}catch(t){return void n.error(t)}this.nextOrComplete(t,e)},e.prototype.nextOrComplete=function(t,e){var n=this.destination;Boolean(e)?n.next(t):(this.inclusive&&n.next(t),n.complete())},e}(i.a)},function(t,e){},function(t,e){},function(t,e){},,,function(t,e,n){"use strict";n.r(e);n(34);var r={"OpenStreetMap layer":{layers:[{type:"XYZ",url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png"}],size:[800,600],center:[12,48],dpi:200,scale:4e7,scaleBar:{position:"bottom-right",units:"metric"},projection:"EPSG:3857",northArrow:"top-right"},"Tiled WMS layer":{layers:[{type:"WMS",url:"https://ows.mundialis.de/services/service",layer:"TOPO-OSM-WMS",tiled:!0}],size:[800,600],center:[12,48],dpi:200,scale:4e7,scaleBar:{position:"bottom-right",units:"metric"},projection:"EPSG:3857",northArrow:"top-right"}};class i extends HTMLElement{constructor(){super(),this.editable_=!1,this.currentSpecName_=null,this.presetSpecElts=null,this.textElt=null}get value(){return JSON.parse(this.textElt.value)}connectedCallback(){const t=Object.keys(r);this.innerHTML=`\n<div>\n  <div class="dropdown">\n    <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n      Choose a predefined spec below\n    </button>\n    <div class="dropdown-menu" aria-label="List of print specs">\n      ${t.map(t=>`\n        <button type="button" class="dropdown-item preset-spec" data-name="${t}">\n          ${t}\n        </button>`).join("\n")}\n    </div>\n  </div>\n  <label class="d-block mt-2">\n    <textarea\n      class="spec form-control text-monospace"\n      rows="20"\n      style="font-size: 12px"\n    ></textarea>\n    <small class="text-secondary">\n      Please provide a valid JSON object.\n    </small>\n  </label>\n</div>`,this.presetSpecElts=Array.from(this.querySelectorAll(".preset-spec")),this.textElt=this.querySelector(".spec"),this.editable_="true"===this.getAttribute("editable"),this.presetSpecElts.forEach(t=>t.addEventListener("click",()=>{this.selectSpec(t.getAttribute("data-name")),this.refreshDOM()})),this.textElt.addEventListener("change",()=>{this.currentSpecName_=null}),this.selectSpec(t[0]),this.refreshDOM()}selectSpec(t){this.currentSpecName_=t;const e=r[t];this.textElt.value=JSON.stringify(e,null,2)}refreshDOM(){this.textElt.parentElement.classList.toggle("d-none",!this.editable_),this.textElt.parentElement.classList.toggle("d-block",this.editable_),this.presetSpecElts.forEach(t=>{const e=t.getAttribute("data-name");t.classList.toggle("active",e===this.currentSpecName_)})}}customElements.define("print-spec",i);var o=n(0),s=n(1);function a(t,e){return function(n){return n.lift(new u(t,e))}}var u=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.predicate,this.thisArg))},t}(),c=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return o.a(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(s.a),l=n(13);var h=function(){function t(t,e,n){void 0===n&&(n=!1),this.accumulator=t,this.seed=e,this.hasSeed=n}return t.prototype.call=function(t,e){return e.subscribe(new p(t,this.accumulator,this.seed,this.hasSeed))},t}(),p=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.accumulator=n,o._seed=r,o.hasSeed=i,o.index=0,o}return o.a(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.accumulator(this.seed,t,n)}catch(t){this.destination.error(t)}this.seed=e,this.destination.next(e)},e}(s.a),f=n(45),d=n(30),g=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return o.a(e,t),e.prototype.schedule=function(e,n){return void 0===n&&(n=0),n>0?t.prototype.schedule.call(this,e,n):(this.delay=n,this.state=e,this.scheduler.flush(this),this)},e.prototype.execute=function(e,n){return n>0||this.closed?t.prototype.execute.call(this,e,n):this._execute(e,n)},e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?t.prototype.requestAsyncId.call(this,e,n,r):e.flush(this)},e}(n(32).a),_=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.a(e,t),e}(n(31).a))(g),y=n(3),v=n(2),m=new v.a((function(t){return t.complete()}));function b(t){return t?function(t){return new v.a((function(e){return t.schedule((function(){return e.complete()}))}))}(t):m}var x,w=n(28);function T(t){var e=t.error;t.subscriber.error(e)}x||(x={});var S=function(){function t(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},t.prototype.accept=function(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)},t.prototype.toObservable=function(){var t,e;switch(this.kind){case"N":return Object(w.a)(this.value);case"E":return t=this.error,e?new v.a((function(n){return e.schedule(T,0,{error:t,subscriber:n})})):new v.a((function(e){return e.error(t)}));case"C":return b()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}();var E=function(t){function e(e,n,r){void 0===r&&(r=0);var i=t.call(this,e)||this;return i.scheduler=n,i.delay=r,i}return o.a(e,t),e.dispatch=function(t){var e=t.notification,n=t.destination;e.observe(n),this.unsubscribe()},e.prototype.scheduleMessage=function(t){this.destination.add(this.scheduler.schedule(e.dispatch,this.delay,new O(t,this.destination)))},e.prototype._next=function(t){this.scheduleMessage(S.createNext(t))},e.prototype._error=function(t){this.scheduleMessage(S.createError(t)),this.unsubscribe()},e.prototype._complete=function(){this.scheduleMessage(S.createComplete()),this.unsubscribe()},e}(s.a),O=function(){return function(t,e){this.notification=t,this.destination=e}}(),P=n(10),j=n(29),R=function(t){function e(e,n,r){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=t.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=e<1?1:e,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return o.a(e,t),e.prototype.nextInfiniteTimeWindow=function(e){if(!this.isStopped){var n=this._events;n.push(e),n.length>this._bufferSize&&n.shift()}t.prototype.next.call(this,e)},e.prototype.nextTimeWindow=function(e){this.isStopped||(this._events.push(new C(this._getNow(),e)),this._trimBufferThenGetEvents()),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){var e,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=r.length;if(this.closed)throw new P.a;if(this.isStopped||this.hasError?e=y.a.EMPTY:(this.observers.push(t),e=new j.a(this,t)),i&&t.add(t=new E(t,i)),n)for(var s=0;s<o&&!t.closed;s++)t.next(r[s]);else for(s=0;s<o&&!t.closed;s++)t.next(r[s].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),e},e.prototype._getNow=function(){return(this.scheduler||_).now()},e.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),e=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(t-r[o].time<n);)o++;return i>e&&(o=Math.max(o,i-e)),o>0&&r.splice(0,o),r},e}(d.a),C=function(){return function(t,e){this.time=t,this.value=e}}();var I=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new M(t))},t}(),M=function(t){function e(e){var n=t.call(this,e)||this;return n.hasPrev=!1,n}return o.a(e,t),e.prototype._next=function(t){var e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)},e}(s.a),F=n(35),A=n(26),L=n(36),k=n(37),z=n(46);function N(t,e){const n=document.createElement("a"),r=URL.createObjectURL(t);n.setAttribute("download",e),n.setAttribute("href",r),n.click()}const G=new Promise((t,e)=>{HTMLCanvasElement.prototype.transferControlToOffscreen?navigator.serviceWorker.register("inkmap-worker.js").then(()=>{setTimeout(()=>{navigator.serviceWorker.controller||t(!1),t(!0)},100)},t=>{console.log("Service worker registration failed:",t),e()}):t(!1)}).then(t=>console.log("[inkmap] Ready, "+(t?"using worker":"using main thread")));function U(t,e){G.then(n=>{n?navigator.serviceWorker.controller.postMessage({...e,type:t}):window.dispatchEvent(new CustomEvent("inkmap.toPrinter",{detail:{...e,type:t}}))})}const W=Object(A.a)(G).pipe(Object(F.a)(t=>(t?Object(L.a)(navigator.serviceWorker,"message").pipe(Object(k.a)("data")):Object(L.a)(window,"inkmap.toMain").pipe(Object(k.a)("detail"))).pipe(Object(z.a)(t=>console.log("message to main:",t)))));var Y=n(5);const X=W.pipe(a(t=>t.type===Y.c),Object(l.a)(t=>t.status),function(t,e){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new h(t,e,n))}}((t,e)=>[...t.filter(t=>t.id!==e.id),e],[]),Object(f.a)([]),(V=(Z={bufferSize:1,refCount:!0})&&"object"==typeof Z?Z:{bufferSize:Z,windowTime:K,refCount:!1,scheduler:D},function(t){return t.lift(function(t){var e,n,r=t.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,o=t.windowTime,s=void 0===o?Number.POSITIVE_INFINITY:o,a=t.refCount,u=t.scheduler,c=0,l=!1,h=!1;return function(t){var r;c++,!e||l?(l=!1,e=new R(i,s,u),r=e.subscribe(this),n=t.subscribe({next:function(t){e.next(t)},error:function(t){l=!0,e.error(t)},complete:function(){h=!0,n=void 0,e.complete()}})):r=e.subscribe(this),this.add((function(){c--,r.unsubscribe(),n&&!h&&a&&0===c&&(n.unsubscribe(),n=void 0,e=void 0)}))}}(V))}));var Z,K,D,V;const q=X.pipe((function(t){return t.lift(new I)}),Object(F.a)(([t,e])=>Object(A.a)(e.filter(e=>!t.some(t=>t.id===e.id)))));function B(t){return X.pipe(Object(l.a)(e=>e.find(e=>e.id===t)),a(t=>!!t))}var H=function(){function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t}();function Q(t){return function(e){return 0===t?b():e.lift(new $(t))}}var $=function(){function t(t){if(this.total=t,this.total<0)throw new H}return t.prototype.call=function(t,e){return e.subscribe(new J(t,this.total))},t}(),J=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}return o.a(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(s.a),tt=n(38);n(33);function et(){return`inkmap-${(new Date).toISOString().substr(0,10)}.png`}const nt=document.querySelector(".example-01"),rt=nt.querySelector("custom-button"),it=nt.querySelector("print-spec");rt.addEventListener("click",async()=>{rt.working=!0;const t=await(e=it.value,U(Y.b,{spec:e}),q.pipe(Q(1),Object(F.a)(t=>B(t.id)),Object(tt.a)(t=>t.progress<1,!0),Object(l.a)(t=>t.imageBlob)).toPromise());var e;rt.working=!1,N(t,et())});const ot=document.querySelector(".example-02"),st=ot.querySelector("custom-button"),at=ot.querySelector("print-spec");st.addEventListener("click",async()=>{st.working=!0;var t;(function(t){return B(t).pipe(Object(tt.a)(t=>t.progress<1,!0))})(await(t=at.value,U(Y.b,{spec:t}),q.pipe(Q(1),Object(l.a)(t=>t.id)).toPromise())).subscribe(t=>{st.progress=t.progress,1===t.progress&&(st.working=!1,N(t.imageBlob,et()))})});n(39),n(40),n(41)},function(t,e,n){"use strict";n.d(e,"a",(function(){return g}));var r=n(28),i=n(0),o=n(13),s=n(26),a=n(6);function u(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?function(r){return r.pipe(u((function(n,r){return Object(s.a)(t(n,r)).pipe(Object(o.a)((function(t,i){return e(n,t,r,i)})))}),n))}:("number"==typeof e&&(n=e),function(e){return e.lift(new c(t,n))})}var c=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new l(t,this.project,this.concurrent))},t}(),l=function(t){function e(e,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=t.call(this,e)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return i.a(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new a.a(this),n=this.destination;n.add(e);var r=Object(a.c)(t,e);r!==e&&n.add(r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(a.b),h=n(21);function p(){return void 0===(t=1)&&(t=Number.POSITIVE_INFINITY),u(h.a,t);var t}function f(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return p()(r.a.apply(void 0,t))}var d=n(16);function g(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return Object(d.a)(n)?(t.pop(),function(e){return f(t,e,n)}):function(e){return f(t,e)}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(0),i=n(1);function o(){}var s=n(8);function a(t,e,n){return function(r){return r.lift(new u(t,e,n))}}var u=function(){function t(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.nextOrObserver,this.error,this.complete))},t}(),c=function(t){function e(e,n,r,i){var a=t.call(this,e)||this;return a._tapNext=o,a._tapError=o,a._tapComplete=o,a._tapError=r||o,a._tapComplete=i||o,Object(s.a)(n)?(a._context=a,a._tapNext=n):n&&(a._context=n,a._tapNext=n.next||o,a._tapError=n.error||o,a._tapComplete=n.complete||o),a}return r.a(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(i.a)}]);
//# sourceMappingURL=app.js.map